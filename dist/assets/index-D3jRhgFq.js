(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class L{constructor({modelManager:e,uiManager:t,selectionManager:s,analysisManager:n,reportManager:i}){this.modelManager=e,this.uiManager=t,this.selectionManager=s,this.analysisManager=n,this.reportManager=i,this.currentUser=null,this.currentCase=null}async initialize(){this.setupLoginHandlers(),this.setupNavigationHandlers(),this.setupSelectionHandlers(),this.setupAnalysisHandlers(),this.setupReportHandlers(),this.setupUploadHandlers(),this.setupScreenCaptureHandlers(),this.setupTabAnalysisHandlers(),this.setupExternalContentHandlers(),this.selectionManager.initialize(),this.checkSession()}checkSession(){const e=localStorage.getItem("currentUser");e&&(this.currentUser=JSON.parse(e),this.showMainApp())}setupLoginHandlers(){document.getElementById("login-form").addEventListener("submit",async t=>{t.preventDefault();const s=document.getElementById("doctor-id").value,n=document.getElementById("password").value;s&&n&&(this.currentUser={id:s,name:`Dr. ${s}`,loginTime:new Date().toISOString()},localStorage.setItem("currentUser",JSON.stringify(this.currentUser)),this.uiManager.showToast("success","Login Successful","Welcome back!"),this.showMainApp())}),document.getElementById("logout-btn").addEventListener("click",()=>{this.logout()})}showMainApp(){document.getElementById("login-screen").classList.remove("active"),document.getElementById("main-app").classList.add("active"),document.getElementById("doctor-name").textContent=this.currentUser.name,this.loadAIModel()}async loadAIModel(){const e=document.getElementById("model-status");e.className="model-status loading",e.innerHTML='<i class="fas fa-circle"></i><span>Loading AI Model...</span>';try{await this.modelManager.initialize(t=>{e.querySelector("span").textContent=`Loading AI Model... ${Math.round(t*100)}%`}),e.className="model-status ready",e.innerHTML='<i class="fas fa-circle"></i><span>AI Model Ready (Local)</span>',this.uiManager.showToast("success","AI Model Loaded","Running locally on your device")}catch(t){console.error("Model loading failed:",t),e.className="model-status error",e.innerHTML='<i class="fas fa-circle"></i><span>Model Load Failed</span>',this.uiManager.showToast("error","Model Error","Could not load AI model. Using fallback mode.")}}logout(){localStorage.removeItem("currentUser"),this.currentUser=null,document.getElementById("main-app").classList.remove("active"),document.getElementById("login-screen").classList.add("active"),this.uiManager.showToast("info","Logged Out","See you next time!")}setupNavigationHandlers(){document.querySelectorAll(".case-item").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".case-item").forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.currentCase=e.dataset.case,this.uiManager.showToast("info","Case Loaded",e.querySelector(".case-name").textContent)})}),document.getElementById("close-analysis").addEventListener("click",()=>{document.getElementById("analysis-panel").classList.add("hidden")})}setupSelectionHandlers(){this.selectionManager.on("selection",e=>{this.handleContentSelection(e)}),document.getElementById("analyze-selection").addEventListener("click",()=>{const e=this.selectionManager.getCurrentSelection();e&&this.startAnalysis(e)}),document.getElementById("copy-selection").addEventListener("click",()=>{const e=this.selectionManager.getCurrentSelection();e&&e.type==="text"&&(navigator.clipboard.writeText(e.content),this.uiManager.showToast("success","Copied","Text copied to clipboard"))}),document.getElementById("highlight-selection").addEventListener("click",()=>{this.selectionManager.highlightSelection(),this.uiManager.showToast("info","Highlighted","Selection highlighted")})}handleContentSelection(e){const t=document.getElementById("selection-toolbar");t.classList.add("visible"),e.position&&(t.style.left=`${e.position.x}px`,t.style.top=`${e.position.y-50}px`),this.updatePreview(e),document.getElementById("analysis-panel").classList.remove("hidden")}updatePreview(e){const t=document.getElementById("preview-area");switch(e.type){case"text":t.innerHTML=`<div class="text-preview">${e.content.substring(0,300)}${e.content.length>300?"...":""}</div>`;break;case"image":t.innerHTML=`<img src="${e.content}" alt="Selected image">`;break;case"video":t.innerHTML=`<video src="${e.content}" controls></video>`;break;case"screen":t.innerHTML=`<img src="${e.content}" alt="Screen capture">`;break;default:t.innerHTML="<p>No content selected</p>"}}setupAnalysisHandlers(){document.querySelectorAll(".option-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".option-btn").forEach(t=>t.classList.remove("active")),e.classList.add("active")})}),document.getElementById("run-analysis").addEventListener("click",async()=>{const e=this.selectionManager.getCurrentSelection();if(!e){this.uiManager.showToast("warning","No Selection","Please select content to analyze");return}const t=document.querySelector(".option-btn.active").dataset.analysis;await this.runAnalysis(e,t)}),document.getElementById("add-to-report").addEventListener("click",()=>{const e=document.getElementById("result-content").textContent;e&&!e.includes("Select content")&&(this.reportManager.addFinding(e),this.uiManager.showToast("success","Added","Finding added to report"))}),document.getElementById("regenerate-result").addEventListener("click",async()=>{const e=this.selectionManager.getCurrentSelection(),t=document.querySelector(".option-btn.active").dataset.analysis;e&&await this.runAnalysis(e,t)})}async runAnalysis(e,t){const s=document.getElementById("analysis-progress"),n=document.getElementById("progress-fill"),i=document.getElementById("progress-text"),a=document.getElementById("result-content"),o=document.getElementById("result-actions");s.style.display="block",o.style.display="none",a.innerHTML='<p class="placeholder-text">Analyzing...</p>';try{for(let c=0;c<=100;c+=10)n.style.width=`${c}%`,i.textContent=`Analyzing... ${c}%`,await new Promise(l=>setTimeout(l,100));const r=await this.analysisManager.analyze(e,t);a.innerHTML=this.formatAnalysisResult(r),o.style.display="flex",this.uiManager.showToast("success","Analysis Complete","AI analysis finished - review and approve")}catch(r){console.error("Analysis error:",r),a.innerHTML='<p class="error-text">Analysis failed. Please try again.</p>',this.uiManager.showToast("error","Analysis Failed",r.message)}finally{s.style.display="none"}}formatAnalysisResult(e){if(typeof e=="string")return`<div class="analysis-text">${e}</div>`;let t="";return e.summary&&(t+=`<div class="result-section"><strong>Summary:</strong><p>${e.summary}</p></div>`),e.findings&&e.findings.length&&(t+='<div class="result-section"><strong>Key Findings:</strong><ul>',e.findings.forEach(s=>{t+=`<li>${s}</li>`}),t+="</ul></div>"),e.recommendations&&e.recommendations.length&&(t+='<div class="result-section"><strong>Recommendations:</strong><ul>',e.recommendations.forEach(s=>{t+=`<li>${s}</li>`}),t+="</ul></div>"),e.confidence&&(t+=`<div class="result-section"><strong>Confidence:</strong> ${Math.round(e.confidence*100)}%</div>`),t||"<p>No analysis results available</p>"}setupReportHandlers(){document.getElementById("save-draft").addEventListener("click",()=>{this.reportManager.saveDraft(),this.uiManager.showToast("success","Draft Saved","Report draft saved locally")}),document.getElementById("submit-report").addEventListener("click",async()=>{if(confirm("Submit this report? Only the structured report data will be sent to the server."))try{await this.reportManager.submitReport(),this.uiManager.showToast("success","Report Submitted","Report submitted successfully")}catch(t){this.uiManager.showToast("error","Submit Failed",t.message)}})}setupUploadHandlers(){const e=document.getElementById("upload-btn"),t=document.getElementById("upload-modal"),s=document.getElementById("upload-zone"),n=document.getElementById("file-input"),i=document.getElementById("upload-preview");e.addEventListener("click",()=>{t.classList.add("active")}),t.querySelectorAll(".modal-close").forEach(a=>{a.addEventListener("click",()=>{t.classList.remove("active")})}),n.addEventListener("change",a=>{this.handleFiles(a.target.files,i)}),s.addEventListener("dragover",a=>{a.preventDefault(),s.classList.add("dragover")}),s.addEventListener("dragleave",()=>{s.classList.remove("dragover")}),s.addEventListener("drop",a=>{a.preventDefault(),s.classList.remove("dragover"),this.handleFiles(a.dataTransfer.files,i)}),s.addEventListener("click",()=>{n.click()}),document.getElementById("confirm-upload").addEventListener("click",()=>{this.processUploadedFiles(),t.classList.remove("active"),this.uiManager.showToast("success","Files Uploaded","Files added to patient content")})}handleFiles(e,t){t.innerHTML="",this.uploadedFiles=[],Array.from(e).forEach(s=>{this.uploadedFiles.push(s);const n=document.createElement("div");if(n.className="upload-preview-item",s.type.startsWith("image/")){const i=document.createElement("img");i.src=URL.createObjectURL(s),n.appendChild(i)}else if(s.type.startsWith("video/")){const i=document.createElement("video");i.src=URL.createObjectURL(s),n.appendChild(i)}else n.innerHTML=`<i class="fas fa-file"></i><span>${s.name}</span>`;t.appendChild(n)})}processUploadedFiles(){this.uploadedFiles&&this.uploadedFiles.forEach(e=>{const t=URL.createObjectURL(e);e.type.startsWith("image/")?this.addImageToContent(t,e.name):e.type.startsWith("video/")&&this.addVideoToContent(t,e.name)})}addImageToContent(e,t){const s=document.querySelector(".image-gallery"),n=document.createElement("div");n.className="image-container selectable-content",n.dataset.type="image",n.innerHTML=`
            <img src="${e}" alt="${t}">
            <span class="image-label">${t}</span>
        `,s.appendChild(n),this.selectionManager.registerElement(n)}addVideoToContent(e,t){const s=document.querySelector(".video-gallery"),n=document.createElement("div");n.className="video-container selectable-content",n.dataset.type="video",n.innerHTML=`
            <video src="${e}" controls></video>
            <span class="video-label">${t}</span>
        `,s.appendChild(n),this.selectionManager.registerElement(n)}setupScreenCaptureHandlers(){const e=document.getElementById("capture-screen-btn"),t=document.getElementById("screen-capture-overlay"),s=document.getElementById("capture-canvas");e.addEventListener("click",()=>{this.startScreenCapture()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&t.classList.contains("active")&&t.classList.remove("active")});let n=!1,i,a;const o=s.getContext("2d");t.addEventListener("mousedown",r=>{n=!0,i=r.clientX,a=r.clientY}),t.addEventListener("mousemove",r=>{if(!n)return;s.width=window.innerWidth,s.height=window.innerHeight,o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(0,0,s.width,s.height);const c=r.clientX-i,l=r.clientY-a;o.clearRect(i,a,c,l),o.strokeStyle="#2563eb",o.lineWidth=2,o.strokeRect(i,a,c,l)}),t.addEventListener("mouseup",async r=>{if(!n)return;n=!1;const c=r.clientX-i,l=r.clientY-a;Math.abs(c)>10&&Math.abs(l)>10&&await this.captureRegion(i,a,c,l),t.classList.remove("active"),o.clearRect(0,0,s.width,s.height)})}async startScreenCapture(){try{const e=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}),t=document.createElement("video");t.srcObject=e,await t.play();const s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0),e.getTracks().forEach(a=>a.stop());const i=s.toDataURL("image/png");this.addImageToContent(i,"Screen Capture - "+new Date().toLocaleTimeString()),this.selectionManager.setSelection({type:"screen",content:i,timestamp:Date.now()}),this.uiManager.showToast("success","Screen Captured","Screen capture added to content")}catch(e){console.error("Screen capture failed:",e),this.uiManager.showToast("error","Capture Failed","Could not capture screen")}}async captureRegion(e,t,s,n){this.uiManager.showToast("info","Region Selected",`Region: ${Math.abs(s)}x${Math.abs(n)} pixels`)}setupTabAnalysisHandlers(){const e=document.getElementById("analyze-tab-btn");e==null||e.addEventListener("click",async()=>{await this.analyzeVisibleContent()})}async analyzeVisibleContent(){this.uiManager.showToast("info","Capturing Content","Analyzing visible content...");try{const e=document.getElementById("content-display"),t={text:[],images:[],timestamp:Date.now()};e.querySelectorAll("p, span, div, h1, h2, h3, h4, h5, h6, li, td, th").forEach(o=>{var c;const r=(c=o.innerText)==null?void 0:c.trim();r&&r.length>10&&t.text.push(r)}),e.querySelectorAll("img").forEach(o=>{o.src&&!o.src.includes("data:image/svg+xml")&&t.images.push({src:o.src,alt:o.alt||"Medical image"})});let i=null;try{i=await this.captureCurrentView()}catch(o){console.log("Screen capture skipped:",o.message)}const a=t.text.join(`

`);if(a.length<20&&t.images.length===0&&!i){this.uiManager.showToast("warning","No Content","No analyzable content found. Try loading patient data first.");return}this.selectionManager.setSelection({type:"combined",content:{text:a,images:t.images,screenshot:i},position:{x:window.innerWidth/2,y:100},timestamp:Date.now()}),this.updateCombinedPreview(t,i),document.getElementById("analysis-panel").classList.remove("hidden"),this.uiManager.showToast("success","Content Captured",`Found ${t.text.length} text sections and ${t.images.length} images`)}catch(e){console.error("Tab analysis error:",e),this.uiManager.showToast("error","Capture Failed","Could not analyze visible content")}}async captureCurrentView(){const e=document.getElementById("content-display"),t=document.createElement("canvas"),s=e.getBoundingClientRect();return t.width=s.width,t.height=Math.min(s.height,800),null}updateCombinedPreview(e,t){const s=document.getElementById("preview-area");let n='<div class="combined-preview">';if(t&&(n+=`<img src="${t}" alt="Screen capture" style="max-width:100%; margin-bottom:10px;">`),e.text.length>0){const i=e.text.slice(0,3).join(" ").substring(0,200);n+=`<div class="text-preview"><strong>Text Content:</strong><br>${i}...</div>`}e.images.length>0&&(n+=`<div style="margin-top:8px;"><strong>Images:</strong> ${e.images.length} medical image(s) found</div>`),n+="</div>",s.innerHTML=n}setupExternalContentHandlers(){const e=document.getElementById("load-external-url"),t=document.getElementById("external-url");e==null||e.addEventListener("click",()=>{const s=t.value.trim();s?this.loadExternalContent(s):this.uiManager.showToast("warning","No URL","Please enter a URL to load")}),t==null||t.addEventListener("keypress",s=>{s.key==="Enter"&&e.click()})}loadExternalContent(e){const t=document.getElementById("external-frame-container");t.innerHTML=`
            <div class="external-content-notice" style="padding: 1rem; background: #fef3c7; border-radius: 8px; margin-bottom: 1rem;">
                <i class="fas fa-info-circle"></i>
                <strong>Note:</strong> Due to browser security, some sites may not load in the frame. 
                Use "Capture Screen" to analyze content from any tab.
            </div>
            <iframe 
                src="${e}" 
                sandbox="allow-same-origin allow-scripts"
                style="width:100%; height:400px; border:1px solid #e2e8f0; border-radius:8px;">
            </iframe>
        `,this.uiManager.showToast("info","Loading URL","Attempting to load external content...")}}const x="modulepreload",T=function(u){return"/"+u},C={},A=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(r=>{if(r=T(r),r in C)return;C[r]=!0;const c=r.endsWith(".css"),l=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${l}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":x,c||(d.as="script"),d.crossOrigin="",d.href=r,o&&d.setAttribute("nonce",o),document.head.appendChild(d),c)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})};class R{constructor(){this.dbName="AImedicalAssistantDB",this.dbVersion=1,this.db=null,this.stores={models:"models",settings:"settings",reports:"reports"}}async initialize(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>{console.error("Failed to open IndexedDB:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("âœ… CacheManager: IndexedDB initialized"),e(this.db)},s.onupgradeneeded=n=>{const i=n.target.result;if(!i.objectStoreNames.contains(this.stores.models)){const a=i.createObjectStore(this.stores.models,{keyPath:"id"});a.createIndex("name","name",{unique:!1}),a.createIndex("version","version",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1})}if(i.objectStoreNames.contains(this.stores.settings)||i.createObjectStore(this.stores.settings,{keyPath:"key"}),!i.objectStoreNames.contains(this.stores.reports)){const a=i.createObjectStore(this.stores.reports,{keyPath:"id"});a.createIndex("patientId","patientId",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1})}console.log("âœ… CacheManager: Database schema created")}})}async isModelCached(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([this.stores.models],"readonly").objectStore(this.stores.models).get(e);a.onsuccess=()=>{t(!!a.result)},a.onerror=()=>{s(a.error)}})}async getModel(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([this.stores.models],"readonly").objectStore(this.stores.models).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{s(a.error)}})}async saveModel(e,t,s={}){return this.db||await this.initialize(),new Promise((n,i)=>{const o=this.db.transaction([this.stores.models],"readwrite").objectStore(this.stores.models),r={id:e,name:s.name||e,version:s.version||"1.0.0",data:t,size:s.size||0,timestamp:Date.now(),metadata:s},c=o.put(r);c.onsuccess=()=>{console.log(`âœ… Model cached: ${e}`),n(r)},c.onerror=()=>{console.error(`âŒ Failed to cache model: ${e}`,c.error),i(c.error)}})}async deleteModel(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([this.stores.models],"readwrite").objectStore(this.stores.models).delete(e);a.onsuccess=()=>{console.log(`âœ… Model deleted: ${e}`),t()},a.onerror=()=>{s(a.error)}})}async getAllModels(){return this.db||await this.initialize(),new Promise((e,t)=>{const i=this.db.transaction([this.stores.models],"readonly").objectStore(this.stores.models).getAll();i.onsuccess=()=>{e(i.result||[])},i.onerror=()=>{t(i.error)}})}async getCacheSize(){return(await this.getAllModels()).reduce((t,s)=>t+(s.size||0),0)}async clearModelCache(){return this.db||await this.initialize(),new Promise((e,t)=>{const i=this.db.transaction([this.stores.models],"readwrite").objectStore(this.stores.models).clear();i.onsuccess=()=>{console.log("âœ… Model cache cleared"),e()},i.onerror=()=>{t(i.error)}})}async getSetting(e,t=null){return this.db||await this.initialize(),new Promise((s,n)=>{const o=this.db.transaction([this.stores.settings],"readonly").objectStore(this.stores.settings).get(e);o.onsuccess=()=>{var r;s(((r=o.result)==null?void 0:r.value)??t)},o.onerror=()=>{n(o.error)}})}async setSetting(e,t){return this.db||await this.initialize(),new Promise((s,n)=>{const o=this.db.transaction([this.stores.settings],"readwrite").objectStore(this.stores.settings).put({key:e,value:t,timestamp:Date.now()});o.onsuccess=()=>{s()},o.onerror=()=>{n(o.error)}})}async saveReport(e){return this.db||await this.initialize(),new Promise((t,s)=>{const i=this.db.transaction([this.stores.reports],"readwrite").objectStore(this.stores.reports);e.timestamp=Date.now();const a=i.put(e);a.onsuccess=()=>{t(e)},a.onerror=()=>{s(a.error)}})}async getReport(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([this.stores.reports],"readonly").objectStore(this.stores.reports).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{s(a.error)}})}async getAllReports(){return this.db||await this.initialize(),new Promise((e,t)=>{const i=this.db.transaction([this.stores.reports],"readonly").objectStore(this.stores.reports).getAll();i.onsuccess=()=>{e(i.result||[])},i.onerror=()=>{t(i.error)}})}}const y=new R;class D{constructor(){this.isOnline=navigator.onLine,this.listeners=new Map,this.offlineQueue=[],this.initialize()}initialize(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4),console.log(`âœ… OfflineManager: Initialized (${this.isOnline?"Online":"Offline"})`)}handleOnline(){this.isOnline=!0,console.log("ðŸŒ Network: Online"),this.emit("online"),this.processOfflineQueue()}handleOffline(){this.isOnline=!1,console.log("ðŸ“´ Network: Offline"),this.emit("offline")}async checkConnection(){try{const e=await fetch("https://www.google.com/favicon.ico",{method:"HEAD",mode:"no-cors",cache:"no-cache"});return this.isOnline||this.handleOnline(),!0}catch{return this.isOnline&&this.handleOffline(),!1}}getStatus(){var e,t,s;return{isOnline:this.isOnline,effectiveType:((e=navigator.connection)==null?void 0:e.effectiveType)||"unknown",downlink:((t=navigator.connection)==null?void 0:t.downlink)||"unknown",saveData:((s=navigator.connection)==null?void 0:s.saveData)||!1}}isSlowConnection(){const e=navigator.connection;return e?e.saveData||e.effectiveType==="slow-2g"||e.effectiveType==="2g":!1}queueForOnline(e,t){this.offlineQueue.push({action:e,data:t,timestamp:Date.now()}),console.log(`ðŸ“ Queued action for online: ${e}`)}async processOfflineQueue(){if(!(!this.isOnline||this.offlineQueue.length===0)){for(console.log(`â³ Processing ${this.offlineQueue.length} queued actions...`);this.offlineQueue.length>0;){const e=this.offlineQueue.shift();try{this.emit("processQueuedAction",e)}catch(t){console.error("Error processing queued action:",t),this.offlineQueue.unshift(e);break}}console.log("âœ… Offline queue processed")}}async fetchWithFallback(e,t={},s=null){if(!this.isOnline){if(s)return{data:s,fromCache:!0};throw new Error("No internet connection and no cached data available")}try{const n=await fetch(e,{...t,signal:AbortSignal.timeout(t.timeout||3e4)});if(!n.ok)throw new Error(`HTTP error: ${n.status}`);return{data:await n.json(),fromCache:!1}}catch(n){if(s)return console.warn("Fetch failed, using fallback:",n.message),{data:s,fromCache:!0};throw n}}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e),n=s.indexOf(t);n>-1&&s.splice(n,1)}}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(s=>s(t))}}const I=new D,v={textClassification:{id:"Xenova/distilbert-base-uncased-finetuned-sst-2-english",name:"Text Classifier",task:"sentiment-analysis",size:250*1024*1024,description:"General text classification and sentiment analysis",priority:1,required:!0},medicalNER:{id:"Xenova/bert-base-NER",name:"Medical NER",task:"token-classification",size:420*1024*1024,description:"Named entity recognition for medical terms",priority:2,required:!1},textGeneration:{id:"Xenova/flan-t5-small",name:"Text Generator",task:"text2text-generation",size:300*1024*1024,description:"Generate medical summaries and insights",priority:3,required:!1},imageClassification:{id:"Xenova/vit-base-patch16-224",name:"Image Classifier",task:"image-classification",size:350*1024*1024,description:"Analyze medical images",priority:4,required:!1}},g={ent:["sinusitis","rhinitis","otitis","tonsillitis","pharyngitis","laryngitis","adenoid","polyp","septum","deviated","turbinate","eustachian","tympanic","cochlea","vestibular","vertigo","tinnitus","hearing loss","audiometry","endoscopy","laryngoscopy","sensorineural","conductive","mixed hearing loss","cholesteatoma","mastoiditis","labyrinthitis","meniere","acoustic neuroma"],dental:["cavity","caries","enamel","dentin","pulp","root canal","periodontal","gingivitis","periodontitis","plaque","tartar","crown","bridge","implant","extraction","filling","amalgam","composite","veneer","orthodontic","malocclusion","bruxism","tmj","temporomandibular","occlusion","bite","mandible","maxilla","abscess","impacted","wisdom tooth","endodontic","prosthodontic"],dermatology:["melanoma","nevus","mole","lesion","papule","macule","nodule","vesicle","pustule","plaque","dermatitis","eczema","psoriasis","urticaria","hives","rash","erythema","pigmentation","acne","rosacea","alopecia","vitiligo","cellulitis","abscess","ulcer","wound","laceration","abrasion","burn","scar","keloid","basal cell","squamous cell","keratosis","dermoscopy","biopsy"],vitals:["blood pressure","systolic","diastolic","hypertension","hypotension","heart rate","pulse","bradycardia","tachycardia","arrhythmia","temperature","fever","hypothermia","hyperthermia","respiratory rate","tachypnea","bradypnea","dyspnea","oxygen saturation","spo2","hypoxia","cyanosis","bmi","weight","height","obesity","underweight","malnutrition"],cardiology:["ecg","ekg","electrocardiogram","qrs","st segment","p wave","t wave","atrial fibrillation","afib","flutter","pvc","pac","murmur","systolic","diastolic","regurgitation","stenosis","ejection fraction","lvef","cardiomyopathy","heart failure","coronary","angina","infarction","mi","stemi","nstemi","pericarditis","endocarditis","valve","mitral","aortic","tricuspid"],general:["inflammation","infection","lesion","tumor","cyst","abscess","edema","erythema","necrosis","biopsy","pathology","diagnosis","prognosis","acute","chronic","benign","malignant","metastasis","bilateral","unilateral","proximal","distal","anterior","posterior"]},$={analysis:{maxTextLength:5e4}};function k(u){if(u===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(u)/Math.log(e));return parseFloat((u/Math.pow(e,s)).toFixed(2))+" "+t[s]}class z{constructor(){this.models=new Map,this.pipelines=new Map,this.isInitialized=!1,this.useLocalModel=!0,this.loadingState={total:0,loaded:0,currentModel:null,errors:[]},this.modelConfig=v,this.transformers=null}async initialize(e,t={}){if(this.isInitialized)return{success:!0,cached:!0};const{loadRequired:s=!0,loadOptional:n=!1,forceDownload:i=!1}=t;try{await y.initialize(),this.transformers=await A(()=>import("./transformers-1Sy6Yw1y.js"),[]);const{pipeline:a,env:o}=this.transformers;o.allowLocalModels=!1,o.useBrowserCache=!0,o.cacheDir=".cache";const r=Object.entries(v).filter(([c,l])=>!!(s&&l.required||n&&!l.required)).sort((c,l)=>c[1].priority-l[1].priority);this.loadingState.total=r.length;for(let c=0;c<r.length;c++){const[l,d]=r[c];this.loadingState.currentModel=d.name;try{await this.loadModel(l,d,h=>{const m=c/r.length,p=h/r.length,f=m+p;e&&e({overall:f,modelProgress:h,currentModel:d.name,modelsLoaded:c,totalModels:r.length})},i),this.loadingState.loaded++}catch(h){if(console.error(`Failed to load model ${l}:`,h),this.loadingState.errors.push({model:l,error:h.message}),d.required)throw new Error(`Required model ${l} failed to load: ${h.message}`)}}return this.isInitialized=!0,e&&e({overall:1,complete:!0}),console.log("âœ… AI Models loaded successfully",{loaded:this.loadingState.loaded,total:this.loadingState.total,errors:this.loadingState.errors.length}),{success:!0,loaded:this.loadingState.loaded,errors:this.loadingState.errors}}catch(a){return console.warn("Could not load Transformers.js models, using fallback mode:",a),this.useLocalModel=!1,this.isInitialized=!0,e&&e({overall:1,complete:!0,fallback:!0}),{success:!1,fallback:!0,error:a.message}}}async loadModel(e,t,s,n=!1){const{pipeline:i}=this.transformers,a=t.id;n||await y.isModelCached(a)&&console.log(`ðŸ“¦ Loading ${t.name} from cache...`);const o=await i(t.task,a,{progress_callback:r=>{r.status==="progress"&&r.progress!==void 0?s(r.progress/100):r.status==="done"&&s(1)}});return this.pipelines.set(e,o),await y.saveModel(a,{key:e,config:t,loadedAt:Date.now()}),console.log(`âœ… Loaded: ${t.name}`),o}getPipeline(e){return this.pipelines.get(e)}async analyzeText(e,t,s=null){if(!e||e.trim().length===0)throw new Error("No text provided for analysis");const n=$.analysis.maxTextLength,i=e.length>n?e.substring(0,n):e;if(this.useLocalModel&&this.pipelines.has("textClassification"))try{const o=await this.pipelines.get("textClassification")(i.substring(0,512));return this.generateMedicalAnalysis(i,o,t,s)}catch(a){console.error("Local model error:",a)}return this.fallbackAnalysis(i,t,s)}async analyzeImage(e,t,s=null){var o,r;const n={results:{}},i=((o=s==null?void 0:s.specialty)==null?void 0:o.id)||"general",a=((r=s==null?void 0:s.reportType)==null?void 0:r.name)||"Medical Image";return t==="diagnosis"?n.results=this.getImageDiagnosisResults(i,a):t==="findings"?n.results=this.getImageFindingsResults(i,a):n.results={summary:`${a} analysis completed for ${i} specialty.`,findings:["Image analyzed based on clinical context"],confidence:.75},n.results}getImageDiagnosisResults(e,t){const n={ent:{summary:`${t} analysis completed. ENT-specific structures evaluated.`,findings:["Airway and mucosal surfaces assessed","Sinus/ear anatomy structures identified","Symmetry and anatomical landmarks noted","Soft tissue and bony structures reviewed"],recommendations:["Correlate with audiometry/tympanometry if applicable","Consider endoscopic examination for detailed assessment","Review for signs of inflammation or obstruction"]},dental:{summary:`${t} analysis completed. Dental structures evaluated.`,findings:["Tooth anatomy and alignment assessed","Periodontal structures reviewed","Bone density and levels evaluated","Root canal and periapical regions examined"],recommendations:["Note any carious lesions or restorations","Evaluate periodontal pocket depths clinically","Consider CBCT for complex cases"]},dermatology:{summary:`${t} analysis completed. Skin lesion evaluated.`,findings:["Lesion borders and symmetry assessed","Color variation and pigmentation noted","Texture and surface characteristics evaluated","Size and dermoscopic patterns documented"],recommendations:["Apply ABCDE criteria for melanoma screening","Consider biopsy if atypical features present","Document for future comparison"]},vitals:{summary:`${t} trends analyzed.`,findings:["Vital sign patterns reviewed","Trend analysis completed","Abnormal values flagged"],recommendations:["Correlate with clinical presentation","Monitor for concerning trends"]},cardiology:{summary:`${t} analysis completed. Cardiac structures evaluated.`,findings:["Cardiac chambers and walls assessed","Valve structures reviewed","Wall motion analysis completed","Great vessels evaluated"],recommendations:["Correlate with ECG findings","Assess ejection fraction","Note any structural abnormalities"]}}[e]||{summary:`${t} analysis completed.`,findings:["Image quality adequate for review","Anatomical structures identified"],recommendations:["Correlate with clinical findings","Review with specialist if needed"]};return n.confidence=.78,n}getImageFindingsResults(e,t){return{summary:`Key findings from ${t} for ${e} review:`,findings:["Primary area of interest identified","Tissue/structure characteristics noted","Comparison baseline established","Measurements documented where applicable"],confidence:.82}}async analyzeVideo(e,t,s=null){const n={results:{}};return n.results={summary:"Video examination analysis completed. Dynamic assessment of the recorded procedure/examination.",findings:["Video quality suitable for clinical assessment","Motion patterns analyzed throughout recording","Key frames identified for detailed review","Temporal progression of examination documented","Areas of clinical interest flagged for attention"],recommendations:["Review highlighted frames for detailed findings","Note any procedural observations","Compare with previous examinations if available","Document findings in structured format"],duration:"Analysis based on video content",confidence:.75},n.results}generateMedicalAnalysis(e,t,s,n=null){var w,b,S,E,M;t[0];const i=e.toLowerCase().split(/\s+/),a=(w=n==null?void 0:n.specialty)==null?void 0:w.id,o=n==null?void 0:n.ageGroup;n==null||n.reportType;let r=[...g.general];a&&g[a]?r=[...g[a],...r]:r=[...g.ent,...g.dental,...g.dermatology,...g.vitals,...g.cardiology,...g.general];const c=this.findMedicalTerms(i,["pain","ache","swelling","inflammation","discharge","fever","loss","difficulty","bleeding","numbness","tingling"]),l=this.findMedicalTerms(i,r),d=this.findMedicalTerms(i,this.getAnatomyTerms(a)),h=this.findMedicalTerms(i,["mild","moderate","severe","acute","chronic","persistent","recurrent","bilateral","unilateral"]),m={summary:"",findings:[],recommendations:[],confidence:0,clinicalContext:n?{specialty:(b=n.specialty)==null?void 0:b.name,ageGroup:(S=n.ageGroup)==null?void 0:S.name,reportType:(E=n.reportType)==null?void 0:E.name}:null},p=((M=n==null?void 0:n.specialty)==null?void 0:M.name)||"General",f=(o==null?void 0:o.name)||"";switch(s){case"diagnosis":m.summary=this.generateDiagnosisSummary(l,d,a,f),m.findings=this.generateDiagnosisFindings(c,l,h,a),m.recommendations=this.generateDiagnosisRecommendations(l,c,a,o),m.confidence=Math.min(.65+l.length*.05+c.length*.03,.92);break;case"summary":m.summary=`${p} assessment for ${f||"patient"}. ${d.length>0?`Involves: ${d.join(", ")}.`:""} ${e.length>200?e.substring(0,200)+"...":e}`,m.confidence=.88;break;case"findings":m.summary=`Key ${p.toLowerCase()} findings extracted:`,m.findings=[`Specialty Focus: ${p}`,`Anatomical areas: ${d.length>0?d.join(", "):"To be identified"}`,`Symptom profile: ${c.length>0?c.join(", "):"To be determined"}`,`Clinical indicators: ${l.length>0?l.join(", "):"Pending evaluation"}`,`Severity: ${h.length>0?h.join(", "):"To be assessed"}`,...f?[`Age considerations: ${f}`]:[]],m.confidence=.8;break;case"recommendations":m.summary=`${p} recommendations based on clinical documentation:`,m.recommendations=this.generateDiagnosisRecommendations(l,c,a,o),m.confidence=.72;break}return m}getAnatomyTerms(e){const t={ent:["ear","nose","throat","sinus","larynx","pharynx","tympanic","cochlea","vestibular","eustachian","turbinate","septum","adenoid","tonsil"],dental:["teeth","tooth","gum","gingiva","tongue","mandible","maxilla","jaw","palate","pulp","root","crown","enamel","dentin"],dermatology:["skin","dermis","epidermis","subcutaneous","nail","hair","scalp","mucosa"],vitals:["heart","lung","chest","abdomen"],cardiology:["heart","cardiac","coronary","valve","ventricle","atrium","aorta","pulmonary"]};return e&&t[e]?t[e]:Object.values(t).flat()}generateDiagnosisSummary(e,t,s,n){let a={ent:"ENT clinical assessment:",dental:"Dental/oral health assessment:",dermatology:"Dermatological assessment:",vitals:"Vital signs assessment:",cardiology:"Cardiovascular assessment:"}[s]||"Clinical assessment:";return e.length>0&&(a+=` Potential conditions: ${e.slice(0,5).join(", ")}.`),t.length>0&&(a+=` Affected areas: ${t.join(", ")}.`),n&&(a+=` (${n} patient)`),e.length===0&&t.length===0&&(a+=" Further clinical evaluation recommended."),a}generateDiagnosisFindings(e,t,s,n){const i=[];e.length>0?i.push(`Reported symptoms: ${e.join(", ")}`):i.push("No specific symptoms documented"),s.length>0&&i.push(`Severity indicators: ${s.join(", ")}`),t.length>0&&i.push(`Possible conditions: ${t.slice(0,5).join(", ")}`);const a={ent:"Consider audiological and vestibular evaluation",dental:"Periodontal and radiographic assessment recommended",dermatology:"Document lesion characteristics (ABCDE)",vitals:"Establish baseline and trend analysis",cardiology:"Correlate with ECG and imaging"};return n&&a[n]&&i.push(a[n]),i.push("Clinical correlation recommended"),i}generateDiagnosisRecommendations(e,t,s,n){const i=[];i.push("Complete clinical examination"),t.some(o=>o.includes("pain"))&&i.push("Assess pain characteristics using appropriate scale"),e.some(o=>o.includes("infection")||o.includes("itis"))&&i.push("Consider culture/sensitivity if infection suspected");const a={ent:["Consider audiometry/tympanometry if hearing concerns","Endoscopic examination if indicated"],dental:["Obtain appropriate radiographs","Periodontal probing assessment"],dermatology:["Dermoscopic examination if indicated","Consider biopsy for suspicious lesions"],vitals:["Monitor trends over time","Review medication effects on vitals"],cardiology:["12-lead ECG if not recent","Consider echocardiogram if structural abnormality suspected"]};if(s&&a[s]&&i.push(...a[s].slice(0,2)),n){const o=n.id;o==="neonate"||o==="infant"?i.push("Age-appropriate developmental assessment"):o==="elderly"?(i.push("Consider geriatric assessment and fall risk"),i.push("Review polypharmacy")):(o==="child"||o==="adolescent")&&i.push("Age-appropriate communication with patient/guardian")}return i.push("Schedule appropriate follow-up"),[...new Set(i)]}fallbackAnalysis(e,t,s=null){return this.generateMedicalAnalysis(e,[{label:"NEUTRAL",score:.5}],t,s)}findMedicalTerms(e,t){const s=new Set;return e.forEach(n=>{t.forEach(i=>{(n.includes(i)||i.includes(n))&&s.add(i)})}),Array.from(s)}async getEmbedding(e){if(this.useLocalModel&&this.pipelines.has("embedding"))try{const s=await this.pipelines.get("embedding")(e,{pooling:"mean",normalize:!0});return Array.from(s.data)}catch(t){console.error("Embedding extraction error:",t)}return null}async getOfflineStatus(){const e={available:[],missing:[],totalCacheSize:0};for(const[t,s]of Object.entries(v))await y.isModelCached(s.id)?e.available.push({key:t,...s}):e.missing.push({key:t,...s});return e.totalCacheSize=await y.getCacheSize(),e.formattedSize=k(e.totalCacheSize),e.isFullyOffline=e.missing.length===0,e}async downloadForOffline(e){if(!I.isOnline)throw new Error("Cannot download models while offline");return this.initialize(e,{loadRequired:!0,loadOptional:!0,forceDownload:!1})}async clearCache(){await y.clearModelCache(),this.pipelines.clear(),this.isInitialized=!1,console.log("ðŸ—‘ï¸ Model cache cleared")}isReady(){return this.isInitialized}getStatus(){return{initialized:this.isInitialized,localModelAvailable:this.useLocalModel,modelsLoaded:Object.fromEntries([...this.pipelines.entries()].map(([e])=>[e,!0])),loadingState:this.loadingState,isOnline:I.isOnline}}}class B{constructor(){this.currentSelection=null,this.listeners=new Map,this.highlightedElements=[]}initialize(){this.setupTextSelection(),this.setupContentSelection(),this.setupKeyboardShortcuts()}setupTextSelection(){document.addEventListener("mouseup",e=>{const t=window.getSelection(),s=t.toString().trim();if(s.length>0){const n=document.getElementById("content-display");if(n&&n.contains(t.anchorNode)){const a=t.getRangeAt(0).getBoundingClientRect();this.setSelection({type:"text",content:s,position:{x:a.left+a.width/2,y:a.top},timestamp:Date.now()})}}}),document.addEventListener("mousedown",e=>{const t=document.getElementById("selection-toolbar");t&&!t.contains(e.target)&&setTimeout(()=>{window.getSelection().toString().trim()||t.classList.remove("visible")},100)})}setupContentSelection(){document.addEventListener("click",e=>{const t=e.target.closest(".selectable-content");if(t)if(document.querySelectorAll(".selectable-content.selected").forEach(s=>{s!==t&&s.classList.remove("selected")}),t.classList.toggle("selected"),t.classList.contains("selected")){const s=t.dataset.type;let n="";switch(s){case"image":const a=t.querySelector("img");n=a?a.src:"";break;case"video":const o=t.querySelector("video");n=o?o.src:"",o&&o.paused&&(n=this.captureVideoFrame(o));break}const i=t.getBoundingClientRect();this.setSelection({type:s,content:n,element:t,position:{x:i.left+i.width/2,y:i.top},timestamp:Date.now()})}else this.clearSelection()})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{var t;(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="A"&&(e.preventDefault(),this.currentSelection&&this.emit("analyze-request",this.currentSelection)),e.key==="Escape"&&(this.clearSelection(),(t=document.getElementById("selection-toolbar"))==null||t.classList.remove("visible"))})}captureVideoFrame(e){try{const t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}catch(t){return console.error("Could not capture video frame:",t),e.src}}setSelection(e){this.currentSelection=e,this.emit("selection",e)}getCurrentSelection(){return this.currentSelection}clearSelection(){this.currentSelection=null,document.querySelectorAll(".selectable-content.selected").forEach(e=>{e.classList.remove("selected")}),this.emit("selection-cleared")}highlightSelection(){if(this.currentSelection)if(this.currentSelection.type==="text"){const e=window.getSelection();if(e.rangeCount>0){const t=e.getRangeAt(0),s=document.createElement("mark");s.className="ai-highlight",s.style.backgroundColor="rgba(37, 99, 235, 0.2)",s.style.padding="2px 0";try{t.surroundContents(s),this.highlightedElements.push(s)}catch(n){console.warn("Could not highlight selection:",n)}}}else this.currentSelection.element&&(this.currentSelection.element.style.outline="3px solid var(--primary-color)",this.highlightedElements.push(this.currentSelection.element))}clearHighlights(){this.highlightedElements.forEach(e=>{e.tagName==="MARK"?e.replaceWith(...e.childNodes):e.style.outline=""}),this.highlightedElements=[]}registerElement(e){e.classList.add("selectable-content"),e.dataset.type=e.dataset.type||"content"}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e),n=s.indexOf(t);n>-1&&s.splice(n,1)}}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(s=>s(t))}getSelectionForAnalysis(){return this.currentSelection?{type:this.currentSelection.type,content:this.currentSelection.content,metadata:{timestamp:this.currentSelection.timestamp,source:"user-selection"}}:null}}class O{constructor(e){this.modelManager=e,this.analysisHistory=[],this.maxHistorySize=50,this.clinicalContext=null}setClinicalContext(e){this.clinicalContext=e}getClinicalContext(){return this.clinicalContext}async analyze(e,t){if(!e)throw new Error("No content selected for analysis");const s=Date.now();let n;switch(e.type){case"text":n=await this.analyzeText(e.content,t);break;case"image":case"screen":n=await this.analyzeImage(e.content,t);break;case"video":n=await this.analyzeVideo(e.content,t);break;case"combined":n=await this.analyzeCombined(e.content,t);break;default:throw new Error(`Unsupported content type: ${e.type}`)}return this.recordAnalysis({type:e.type,analysisType:t,result:n,clinicalContext:this.clinicalContext,duration:Date.now()-s,timestamp:Date.now()}),n}async analyzeText(e,t){if(!e||e.trim().length===0)throw new Error("Empty text cannot be analyzed");return await this.modelManager.analyzeText(e,t,this.clinicalContext)}async analyzeImage(e,t){if(!e)throw new Error("No image data provided");return{...await this.modelManager.analyzeImage(e,t,this.clinicalContext),imageAnalysis:{processed:!0,type:e.startsWith("data:")?"base64":"url"}}}async analyzeVideo(e,t){if(!e)throw new Error("No video data provided");return{...await this.modelManager.analyzeVideo(e,t,this.clinicalContext),videoAnalysis:{processed:!0,frameAnalysis:"Key frames extracted and analyzed"}}}async analyzeCombined(e,t){var n,i,a;const s={summary:"",findings:[],recommendations:[],confidence:0,analysisDetails:{},clinicalContext:this.clinicalContext?{specialty:(n=this.clinicalContext.specialty)==null?void 0:n.name,ageGroup:(i=this.clinicalContext.ageGroup)==null?void 0:i.name,reportType:(a=this.clinicalContext.reportType)==null?void 0:a.name}:null};if(e.text&&e.text.length>0){const o=await this.modelManager.analyzeText(e.text,t,this.clinicalContext);o.summary&&(s.summary=o.summary),o.findings&&s.findings.push(...o.findings),o.recommendations&&s.recommendations.push(...o.recommendations),o.confidence&&(s.confidence=o.confidence),s.analysisDetails.textAnalyzed=!0,s.analysisDetails.textLength=e.text.length}if(e.images&&e.images.length>0){s.findings.push(`${e.images.length} medical image(s) detected and ready for visual review`);for(let o=0;o<Math.min(e.images.length,3);o++){const r=await this.modelManager.analyzeImage(e.images[o].src,t);r.findings&&s.findings.push(...r.findings.slice(0,2))}s.analysisDetails.imagesAnalyzed=e.images.length}return e.screenshot&&(s.findings.push("Screen capture analyzed for visible clinical data"),s.analysisDetails.screenshotAnalyzed=!0),s.findings=[...new Set(s.findings)],s.recommendations=[...new Set(s.recommendations)],s.summary||(s.summary=`Combined analysis of ${s.analysisDetails.textAnalyzed?"clinical text":""}${s.analysisDetails.imagesAnalyzed?` and ${s.analysisDetails.imagesAnalyzed} image(s)`:""}. Review findings below for clinical decision support.`),s}async analyzeMultiple(e,t){const s=await Promise.all(e.map(n=>this.analyze(n,t)));return this.combineResults(s,t)}combineResults(e,t){const s={summary:"",findings:[],recommendations:[],confidence:0,combinedFrom:e.length};return e.forEach(n=>{n.summary&&(s.summary+=n.summary+" "),n.findings&&s.findings.push(...n.findings),n.recommendations&&s.recommendations.push(...n.recommendations),n.confidence&&(s.confidence+=n.confidence)}),s.confidence=s.confidence/e.length,s.findings=[...new Set(s.findings)],s.recommendations=[...new Set(s.recommendations)],s}recordAnalysis(e){this.analysisHistory.push(e),this.analysisHistory.length>this.maxHistorySize&&this.analysisHistory.shift(),this.saveHistory()}saveHistory(){try{const e=this.analysisHistory.slice(-20);localStorage.setItem("analysisHistory",JSON.stringify(e))}catch(e){console.warn("Could not save analysis history:",e)}}loadHistory(){try{const e=localStorage.getItem("analysisHistory");e&&(this.analysisHistory=JSON.parse(e))}catch(e){console.warn("Could not load analysis history:",e)}}getHistory(){return this.analysisHistory}getLastAnalysis(){return this.analysisHistory[this.analysisHistory.length-1]}clearHistory(){this.analysisHistory=[],localStorage.removeItem("analysisHistory")}formatForDisplay(e){let t='<div class="analysis-result-formatted">';if(e.summary&&(t+=`<div class="result-summary"><strong>Summary:</strong> ${e.summary}</div>`),e.findings&&e.findings.length>0&&(t+='<div class="result-findings"><strong>Key Findings:</strong><ul>',e.findings.forEach(s=>{t+=`<li><i class="fas fa-check-circle"></i> ${s}</li>`}),t+="</ul></div>"),e.recommendations&&e.recommendations.length>0&&(t+='<div class="result-recommendations"><strong>Recommendations:</strong><ul>',e.recommendations.forEach(s=>{t+=`<li><i class="fas fa-lightbulb"></i> ${s}</li>`}),t+="</ul></div>"),e.confidence){const s=Math.round(e.confidence*100),n=s>80?"high":s>60?"medium":"low";t+=`<div class="result-confidence ${n}">
                <strong>Confidence:</strong> 
                <span class="confidence-bar">
                    <span class="confidence-fill" style="width: ${s}%"></span>
                </span>
                ${s}%
            </div>`}return t+="</div>",t}exportForReport(e){return{content:e.summary||"",findings:e.findings||[],recommendations:e.recommendations||[],confidence:e.confidence||0,exportedAt:new Date().toISOString(),source:"AI Analysis"}}}class N{constructor(){this.currentReport=this.createNewReport(),this.drafts=[],this.loadDrafts()}createNewReport(){return{id:this.generateId(),patientInfo:{name:"",id:"",dateOfBirth:""},examinationDate:new Date().toISOString().split("T")[0],findings:[],doctorNotes:"",diagnosis:"",recommendations:[],aiAssisted:!0,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}generateId(){return"RPT-"+Date.now().toString(36).toUpperCase()+"-"+Math.random().toString(36).substr(2,5).toUpperCase()}addFinding(e){if(!e||e.trim().length===0)return;const t={id:Date.now(),content:e,source:"ai-analysis",addedAt:new Date().toISOString(),verified:!1};return this.currentReport.findings.push(t),this.updateUI(),this.autoSave(),t}removeFinding(e){this.currentReport.findings=this.currentReport.findings.filter(t=>t.id!==e),this.updateUI(),this.autoSave()}verifyFinding(e){const t=this.currentReport.findings.find(s=>s.id===e);t&&(t.verified=!0,t.verifiedAt=new Date().toISOString()),this.autoSave()}updatePatientInfo(){var e,t,s;this.currentReport.patientInfo={name:((e=document.getElementById("patient-name"))==null?void 0:e.value)||"",id:((t=document.getElementById("patient-id"))==null?void 0:t.value)||""},this.currentReport.examinationDate=((s=document.getElementById("exam-date"))==null?void 0:s.value)||""}updateNotes(){var e,t;this.currentReport.doctorNotes=((e=document.getElementById("doctor-notes"))==null?void 0:e.value)||"",this.currentReport.diagnosis=((t=document.getElementById("final-diagnosis"))==null?void 0:t.value)||""}updateUI(){const e=document.getElementById("findings-list");if(e){if(this.currentReport.findings.length===0){e.innerHTML='<p class="placeholder-text">No findings added yet. Run AI analysis and add results.</p>';return}e.innerHTML=this.currentReport.findings.map(t=>`
            <div class="finding-item" data-id="${t.id}">
                <i class="fas ${t.verified?"fa-check-circle":"fa-circle"}"></i>
                <span class="finding-content">${this.truncate(t.content,100)}</span>
                <i class="fas fa-times remove-finding" onclick="window.medicalAssistantApp.reportManager.removeFinding(${t.id})"></i>
            </div>
        `).join("")}}truncate(e,t){return e.length<=t?e:e.substring(0,t)+"..."}saveDraft(){this.updatePatientInfo(),this.updateNotes(),this.currentReport.updatedAt=new Date().toISOString(),this.currentReport.status="draft";const e=this.drafts.findIndex(t=>t.id===this.currentReport.id);return e>=0?this.drafts[e]={...this.currentReport}:this.drafts.push({...this.currentReport}),this.saveDraftsToStorage(),this.currentReport}autoSave(){clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveDraft()},2e3)}loadDrafts(){try{const e=localStorage.getItem("reportDrafts");e&&(this.drafts=JSON.parse(e))}catch(e){console.warn("Could not load drafts:",e),this.drafts=[]}}saveDraftsToStorage(){try{localStorage.setItem("reportDrafts",JSON.stringify(this.drafts))}catch(e){console.warn("Could not save drafts:",e)}}loadDraft(e){const t=this.drafts.find(s=>s.id===e);t&&(this.currentReport={...t},this.populateForm(),this.updateUI())}populateForm(){const{patientInfo:e,examinationDate:t,doctorNotes:s,diagnosis:n}=this.currentReport;document.getElementById("patient-name")&&(document.getElementById("patient-name").value=e.name||""),document.getElementById("patient-id")&&(document.getElementById("patient-id").value=e.id||""),document.getElementById("exam-date")&&(document.getElementById("exam-date").value=t||""),document.getElementById("doctor-notes")&&(document.getElementById("doctor-notes").value=s||""),document.getElementById("final-diagnosis")&&(document.getElementById("final-diagnosis").value=n||"")}deleteDraft(e){this.drafts=this.drafts.filter(t=>t.id!==e),this.saveDraftsToStorage()}async submitReport(){this.updatePatientInfo(),this.updateNotes();const e=this.validateReport();if(e.length>0)throw new Error(`Validation failed: ${e.join(", ")}`);this.currentReport.status="submitted",this.currentReport.submittedAt=new Date().toISOString();const t=this.prepareForSubmission();console.log("ðŸ“¤ Submitting report:",t),await new Promise(n=>setTimeout(n,1e3)),this.deleteDraft(this.currentReport.id);const s={...this.currentReport};return this.currentReport=this.createNewReport(),this.populateForm(),this.updateUI(),s}validateReport(){const e=[];return this.currentReport.patientInfo.name||e.push("Patient name is required"),this.currentReport.patientInfo.id||e.push("Patient ID is required"),this.currentReport.findings.length===0&&e.push("At least one finding is required"),e}prepareForSubmission(){return{reportId:this.currentReport.id,patient:{name:this.currentReport.patientInfo.name,id:this.currentReport.patientInfo.id},examination:{date:this.currentReport.examinationDate,type:"ENT/Dental"},findings:this.currentReport.findings.map(e=>({content:e.content,source:e.source,verified:e.verified})),doctorNotes:this.currentReport.doctorNotes,diagnosis:this.currentReport.diagnosis,metadata:{aiAssisted:!0,submittedAt:new Date().toISOString(),localProcessing:!0}}}exportAsPDF(){console.log("PDF export would be implemented here"),console.log(this.prepareForSubmission())}exportAsJSON(){const e=this.prepareForSubmission(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=`report-${this.currentReport.id}.json`,n.click(),URL.revokeObjectURL(s)}getDrafts(){return this.drafts}getCurrentReport(){return this.currentReport}}class H{constructor(){this.toastContainer=null,this.initializeToastContainer()}initializeToastContainer(){this.toastContainer=document.getElementById("toast-container"),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.className="toast-container",document.body.appendChild(this.toastContainer))}showToast(e,t,s,n=4e3){const i=document.createElement("div");i.className=`toast ${e}`;const a={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return i.innerHTML=`
            <i class="fas ${a[e]||a.info}"></i>
            <div class="toast-content">
                <div class="toast-title">${t}</div>
                ${s?`<div class="toast-message">${s}</div>`:""}
            </div>
            <button class="toast-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `,this.toastContainer.appendChild(i),setTimeout(()=>{i.style.animation="slideOut 0.3s ease forwards",setTimeout(()=>i.remove(),300)},n),i}showModal(e){const{title:t,content:s,buttons:n=[],onClose:i}=e,a=document.createElement("div");return a.className="modal active",a.innerHTML=`
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${t}</h3>
                    <button class="btn btn-icon modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ${typeof s=="string"?s:""}
                </div>
                <div class="modal-footer">
                    ${n.map(o=>`
                        <button class="btn ${o.primary?"btn-primary":"btn-secondary"}" data-action="${o.action}">
                            ${o.icon?`<i class="fas fa-${o.icon}"></i>`:""}
                            ${o.label}
                        </button>
                    `).join("")}
                </div>
            </div>
        `,typeof s!="string"&&a.querySelector(".modal-body").appendChild(s),a.querySelector(".modal-close").addEventListener("click",()=>{this.closeModal(a),i&&i()}),n.forEach(o=>{const r=a.querySelector(`[data-action="${o.action}"]`);r&&o.onClick&&r.addEventListener("click",()=>{o.onClick(),o.closeOnClick!==!1&&this.closeModal(a)})}),a.addEventListener("click",o=>{o.target===a&&(this.closeModal(a),i&&i())}),document.body.appendChild(a),a}closeModal(e){e.classList.remove("active"),setTimeout(()=>e.remove(),200)}showConfirm(e,t){return new Promise(s=>{this.showModal({title:e,content:`<p>${t}</p>`,buttons:[{label:"Cancel",action:"cancel",onClick:()=>s(!1)},{label:"Confirm",action:"confirm",primary:!0,onClick:()=>s(!0)}],onClose:()=>s(!1)})})}showLoading(e="Loading..."){const t=document.createElement("div");return t.className="loading-overlay",t.id="loading-overlay",t.innerHTML=`
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <span>${e}</span>
            </div>
        `,document.body.appendChild(t),t}hideLoading(){const e=document.getElementById("loading-overlay");e&&e.remove()}updateProgress(e,t,s){if(e){const n=e.querySelector(".progress-fill"),i=e.querySelector(".progress-text");n&&(n.style.width=`${t}%`),i&&s&&(i.textContent=s)}}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}formatTime(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}formatDateTime(e){return`${this.formatDate(e)} ${this.formatTime(e)}`}sanitizeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async copyToClipboard(e){try{return await navigator.clipboard.writeText(e),this.showToast("success","Copied","Text copied to clipboard"),!0}catch(t){return console.error("Copy failed:",t),this.showToast("error","Copy Failed","Could not copy to clipboard"),!1}}}document.addEventListener("DOMContentLoaded",async()=>{console.log("ðŸ¥ AI Medical Assistant - Initializing...");const u=new z,e=new H,t=new B,s=new O(u),n=new N,i=new L({modelManager:u,uiManager:e,selectionManager:t,analysisManager:s,reportManager:n});await i.initialize(),window.medicalAssistantApp=i,console.log("âœ… AI Medical Assistant - Ready")});
//# sourceMappingURL=index-D3jRhgFq.js.map
