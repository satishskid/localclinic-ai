{"version":3,"mappings":"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","names":["App","modelManager","uiManager","selectionManager","analysisManager","reportManager","savedUser","e","doctorId","password","statusEl","progress","error","item","i","selection","toolbar","previewArea","btn","b","analysisType","result","progressEl","progressFill","progressText","resultContent","resultActions","r","html","f","uploadBtn","uploadModal","uploadZone","fileInput","uploadPreview","files","previewContainer","file","img","video","url","name","gallery","container","captureBtn","overlay","canvas","isDrawing","startX","startY","ctx","width","height","stream","track","imageUrl","x","y","analyzeTabBtn","contentDisplay","collectedContent","el","text","_a","screenCapture","combinedText","rect","content","screenshot","previewText","loadUrlBtn","urlInput","CacheManager","resolve","reject","request","event","db","modelsStore","reportsStore","modelId","modelData","metadata","store","record","total","model","key","defaultValue","value","report","reportId","cacheManager","OfflineManager","response","_b","_c","connection","action","data","options","fallbackData","callback","callbacks","index","offlineManager","MODELS","MEDICAL_VOCABULARY","CONFIG","formatBytes","bytes","k","sizes","ModelManager","progressCallback","loadRequired","loadOptional","forceDownload","__vitePreload","pipeline","env","modelsToLoad","_","a","modelKey","modelConfig","modelProgress","baseProgress","modelContribution","totalProgress","loadedPipeline","clinicalContext","maxLength","processedText","classification","imageData","analysis","specialty","reportType","videoData","words","ageGroup","vocabularyToUse","foundSymptoms","foundConditions","foundAnatomy","foundSeverity","results","_d","specialtyName","_e","ageGroupName","anatomyBySpecialty","conditions","anatomy","summary","symptoms","severity","findings","specialtyHints","recommendations","s","c","specialtyRecs","ageId","termList","found","word","term","embedding","status","config","SelectionManager","selectedText","selectableContent","type","range","highlight","element","AnalysisManager","context","startTime","textResult","imageResult","selections","combined","historyToSave","saved","finding","rec","confidencePercent","confidenceClass","ReportManager","findingObj","findingId","findingsList","draftIndex","d","draftId","draft","patientInfo","examinationDate","doctorNotes","diagnosis","errors","reportData","submittedReport","blob","UIManager","title","message","duration","toast","icons","buttons","onClose","modal","button","loader","progressBar","date","str","temp","app"],"ignoreList":[],"sources":["../../src/app/App.js","../../src/core/CacheManager.js","../../src/core/OfflineManager.js","../../src/core/ConfigManager.js","../../src/ai/ModelManager.js","../../src/features/SelectionManager.js","../../src/features/AnalysisManager.js","../../src/features/ReportManager.js","../../src/ui/UIManager.js","../../src/main.js"],"sourcesContent":["/**\n * Main Application Controller\n * Orchestrates all components of the Medical AI Assistant\n */\nexport class App {\n    constructor({ modelManager, uiManager, selectionManager, analysisManager, reportManager }) {\n        this.modelManager = modelManager;\n        this.uiManager = uiManager;\n        this.selectionManager = selectionManager;\n        this.analysisManager = analysisManager;\n        this.reportManager = reportManager;\n        \n        this.currentUser = null;\n        this.currentCase = null;\n    }\n    \n    async initialize() {\n        // Setup event listeners\n        this.setupLoginHandlers();\n        this.setupNavigationHandlers();\n        this.setupSelectionHandlers();\n        this.setupAnalysisHandlers();\n        this.setupReportHandlers();\n        this.setupUploadHandlers();\n        this.setupScreenCaptureHandlers();\n        this.setupTabAnalysisHandlers();\n        this.setupExternalContentHandlers();\n        \n        // Initialize selection manager for content selection\n        this.selectionManager.initialize();\n        \n        // Check for saved session\n        this.checkSession();\n    }\n    \n    checkSession() {\n        const savedUser = localStorage.getItem('currentUser');\n        if (savedUser) {\n            this.currentUser = JSON.parse(savedUser);\n            this.showMainApp();\n        }\n    }\n    \n    setupLoginHandlers() {\n        const loginForm = document.getElementById('login-form');\n        loginForm.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            \n            const doctorId = document.getElementById('doctor-id').value;\n            const password = document.getElementById('password').value;\n            \n            // Simulate login (in production, this would validate against server)\n            if (doctorId && password) {\n                this.currentUser = {\n                    id: doctorId,\n                    name: `Dr. ${doctorId}`,\n                    loginTime: new Date().toISOString()\n                };\n                \n                localStorage.setItem('currentUser', JSON.stringify(this.currentUser));\n                this.uiManager.showToast('success', 'Login Successful', 'Welcome back!');\n                this.showMainApp();\n            }\n        });\n        \n        document.getElementById('logout-btn').addEventListener('click', () => {\n            this.logout();\n        });\n    }\n    \n    showMainApp() {\n        document.getElementById('login-screen').classList.remove('active');\n        document.getElementById('main-app').classList.add('active');\n        document.getElementById('doctor-name').textContent = this.currentUser.name;\n        \n        // Start loading AI model\n        this.loadAIModel();\n    }\n    \n    async loadAIModel() {\n        const statusEl = document.getElementById('model-status');\n        statusEl.className = 'model-status loading';\n        statusEl.innerHTML = '<i class=\"fas fa-circle\"></i><span>Loading AI Model...</span>';\n        \n        try {\n            await this.modelManager.initialize((progress) => {\n                statusEl.querySelector('span').textContent = `Loading AI Model... ${Math.round(progress * 100)}%`;\n            });\n            \n            statusEl.className = 'model-status ready';\n            statusEl.innerHTML = '<i class=\"fas fa-circle\"></i><span>AI Model Ready (Local)</span>';\n            this.uiManager.showToast('success', 'AI Model Loaded', 'Running locally on your device');\n        } catch (error) {\n            console.error('Model loading failed:', error);\n            statusEl.className = 'model-status error';\n            statusEl.innerHTML = '<i class=\"fas fa-circle\"></i><span>Model Load Failed</span>';\n            this.uiManager.showToast('error', 'Model Error', 'Could not load AI model. Using fallback mode.');\n        }\n    }\n    \n    logout() {\n        localStorage.removeItem('currentUser');\n        this.currentUser = null;\n        document.getElementById('main-app').classList.remove('active');\n        document.getElementById('login-screen').classList.add('active');\n        this.uiManager.showToast('info', 'Logged Out', 'See you next time!');\n    }\n    \n    setupNavigationHandlers() {\n        // Case list navigation\n        document.querySelectorAll('.case-item').forEach(item => {\n            item.addEventListener('click', () => {\n                document.querySelectorAll('.case-item').forEach(i => i.classList.remove('active'));\n                item.classList.add('active');\n                this.currentCase = item.dataset.case;\n                this.uiManager.showToast('info', 'Case Loaded', item.querySelector('.case-name').textContent);\n            });\n        });\n        \n        // Close analysis panel\n        document.getElementById('close-analysis').addEventListener('click', () => {\n            document.getElementById('analysis-panel').classList.add('hidden');\n        });\n    }\n    \n    setupSelectionHandlers() {\n        // Listen for selection events\n        this.selectionManager.on('selection', (selection) => {\n            this.handleContentSelection(selection);\n        });\n        \n        // Selection toolbar actions\n        document.getElementById('analyze-selection').addEventListener('click', () => {\n            const selection = this.selectionManager.getCurrentSelection();\n            if (selection) {\n                this.startAnalysis(selection);\n            }\n        });\n        \n        document.getElementById('copy-selection').addEventListener('click', () => {\n            const selection = this.selectionManager.getCurrentSelection();\n            if (selection && selection.type === 'text') {\n                navigator.clipboard.writeText(selection.content);\n                this.uiManager.showToast('success', 'Copied', 'Text copied to clipboard');\n            }\n        });\n        \n        document.getElementById('highlight-selection').addEventListener('click', () => {\n            this.selectionManager.highlightSelection();\n            this.uiManager.showToast('info', 'Highlighted', 'Selection highlighted');\n        });\n    }\n    \n    handleContentSelection(selection) {\n        // Show selection toolbar\n        const toolbar = document.getElementById('selection-toolbar');\n        toolbar.classList.add('visible');\n        \n        // Position toolbar near selection\n        if (selection.position) {\n            toolbar.style.left = `${selection.position.x}px`;\n            toolbar.style.top = `${selection.position.y - 50}px`;\n        }\n        \n        // Update preview\n        this.updatePreview(selection);\n        \n        // Show analysis panel\n        document.getElementById('analysis-panel').classList.remove('hidden');\n    }\n    \n    updatePreview(selection) {\n        const previewArea = document.getElementById('preview-area');\n        \n        switch (selection.type) {\n            case 'text':\n                previewArea.innerHTML = `<div class=\"text-preview\">${selection.content.substring(0, 300)}${selection.content.length > 300 ? '...' : ''}</div>`;\n                break;\n            case 'image':\n                previewArea.innerHTML = `<img src=\"${selection.content}\" alt=\"Selected image\">`;\n                break;\n            case 'video':\n                previewArea.innerHTML = `<video src=\"${selection.content}\" controls></video>`;\n                break;\n            case 'screen':\n                previewArea.innerHTML = `<img src=\"${selection.content}\" alt=\"Screen capture\">`;\n                break;\n            default:\n                previewArea.innerHTML = '<p>No content selected</p>';\n        }\n    }\n    \n    setupAnalysisHandlers() {\n        // Analysis type selection\n        document.querySelectorAll('.option-btn').forEach(btn => {\n            btn.addEventListener('click', () => {\n                document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));\n                btn.classList.add('active');\n            });\n        });\n        \n        // Run analysis button\n        document.getElementById('run-analysis').addEventListener('click', async () => {\n            const selection = this.selectionManager.getCurrentSelection();\n            if (!selection) {\n                this.uiManager.showToast('warning', 'No Selection', 'Please select content to analyze');\n                return;\n            }\n            \n            const analysisType = document.querySelector('.option-btn.active').dataset.analysis;\n            await this.runAnalysis(selection, analysisType);\n        });\n        \n        // Add to report button\n        document.getElementById('add-to-report').addEventListener('click', () => {\n            const result = document.getElementById('result-content').textContent;\n            if (result && !result.includes('Select content')) {\n                this.reportManager.addFinding(result);\n                this.uiManager.showToast('success', 'Added', 'Finding added to report');\n            }\n        });\n        \n        // Regenerate button\n        document.getElementById('regenerate-result').addEventListener('click', async () => {\n            const selection = this.selectionManager.getCurrentSelection();\n            const analysisType = document.querySelector('.option-btn.active').dataset.analysis;\n            if (selection) {\n                await this.runAnalysis(selection, analysisType);\n            }\n        });\n    }\n    \n    async runAnalysis(selection, analysisType) {\n        const progressEl = document.getElementById('analysis-progress');\n        const progressFill = document.getElementById('progress-fill');\n        const progressText = document.getElementById('progress-text');\n        const resultContent = document.getElementById('result-content');\n        const resultActions = document.getElementById('result-actions');\n        \n        // Show progress\n        progressEl.style.display = 'block';\n        resultActions.style.display = 'none';\n        resultContent.innerHTML = '<p class=\"placeholder-text\">Analyzing...</p>';\n        \n        try {\n            // Simulate progress (in real app, this would come from model)\n            for (let i = 0; i <= 100; i += 10) {\n                progressFill.style.width = `${i}%`;\n                progressText.textContent = `Analyzing... ${i}%`;\n                await new Promise(r => setTimeout(r, 100));\n            }\n            \n            // Run actual analysis\n            const result = await this.analysisManager.analyze(selection, analysisType);\n            \n            // Display result\n            resultContent.innerHTML = this.formatAnalysisResult(result);\n            resultActions.style.display = 'flex';\n            \n            this.uiManager.showToast('success', 'Analysis Complete', 'AI analysis finished - review and approve');\n        } catch (error) {\n            console.error('Analysis error:', error);\n            resultContent.innerHTML = '<p class=\"error-text\">Analysis failed. Please try again.</p>';\n            this.uiManager.showToast('error', 'Analysis Failed', error.message);\n        } finally {\n            progressEl.style.display = 'none';\n        }\n    }\n    \n    formatAnalysisResult(result) {\n        if (typeof result === 'string') {\n            return `<div class=\"analysis-text\">${result}</div>`;\n        }\n        \n        let html = '';\n        if (result.summary) {\n            html += `<div class=\"result-section\"><strong>Summary:</strong><p>${result.summary}</p></div>`;\n        }\n        if (result.findings && result.findings.length) {\n            html += '<div class=\"result-section\"><strong>Key Findings:</strong><ul>';\n            result.findings.forEach(f => {\n                html += `<li>${f}</li>`;\n            });\n            html += '</ul></div>';\n        }\n        if (result.recommendations && result.recommendations.length) {\n            html += '<div class=\"result-section\"><strong>Recommendations:</strong><ul>';\n            result.recommendations.forEach(r => {\n                html += `<li>${r}</li>`;\n            });\n            html += '</ul></div>';\n        }\n        if (result.confidence) {\n            html += `<div class=\"result-section\"><strong>Confidence:</strong> ${Math.round(result.confidence * 100)}%</div>`;\n        }\n        \n        return html || '<p>No analysis results available</p>';\n    }\n    \n    setupReportHandlers() {\n        // Save draft\n        document.getElementById('save-draft').addEventListener('click', () => {\n            this.reportManager.saveDraft();\n            this.uiManager.showToast('success', 'Draft Saved', 'Report draft saved locally');\n        });\n        \n        // Submit report\n        document.getElementById('submit-report').addEventListener('click', async () => {\n            const confirmed = confirm('Submit this report? Only the structured report data will be sent to the server.');\n            if (confirmed) {\n                try {\n                    await this.reportManager.submitReport();\n                    this.uiManager.showToast('success', 'Report Submitted', 'Report submitted successfully');\n                } catch (error) {\n                    this.uiManager.showToast('error', 'Submit Failed', error.message);\n                }\n            }\n        });\n    }\n    \n    setupUploadHandlers() {\n        const uploadBtn = document.getElementById('upload-btn');\n        const uploadModal = document.getElementById('upload-modal');\n        const uploadZone = document.getElementById('upload-zone');\n        const fileInput = document.getElementById('file-input');\n        const uploadPreview = document.getElementById('upload-preview');\n        \n        // Open upload modal\n        uploadBtn.addEventListener('click', () => {\n            uploadModal.classList.add('active');\n        });\n        \n        // Close modal\n        uploadModal.querySelectorAll('.modal-close').forEach(btn => {\n            btn.addEventListener('click', () => {\n                uploadModal.classList.remove('active');\n            });\n        });\n        \n        // File input change\n        fileInput.addEventListener('change', (e) => {\n            this.handleFiles(e.target.files, uploadPreview);\n        });\n        \n        // Drag and drop\n        uploadZone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            uploadZone.classList.add('dragover');\n        });\n        \n        uploadZone.addEventListener('dragleave', () => {\n            uploadZone.classList.remove('dragover');\n        });\n        \n        uploadZone.addEventListener('drop', (e) => {\n            e.preventDefault();\n            uploadZone.classList.remove('dragover');\n            this.handleFiles(e.dataTransfer.files, uploadPreview);\n        });\n        \n        // Click to browse\n        uploadZone.addEventListener('click', () => {\n            fileInput.click();\n        });\n        \n        // Confirm upload\n        document.getElementById('confirm-upload').addEventListener('click', () => {\n            this.processUploadedFiles();\n            uploadModal.classList.remove('active');\n            this.uiManager.showToast('success', 'Files Uploaded', 'Files added to patient content');\n        });\n    }\n    \n    handleFiles(files, previewContainer) {\n        previewContainer.innerHTML = '';\n        this.uploadedFiles = [];\n        \n        Array.from(files).forEach(file => {\n            this.uploadedFiles.push(file);\n            \n            const item = document.createElement('div');\n            item.className = 'upload-preview-item';\n            \n            if (file.type.startsWith('image/')) {\n                const img = document.createElement('img');\n                img.src = URL.createObjectURL(file);\n                item.appendChild(img);\n            } else if (file.type.startsWith('video/')) {\n                const video = document.createElement('video');\n                video.src = URL.createObjectURL(file);\n                item.appendChild(video);\n            } else {\n                item.innerHTML = `<i class=\"fas fa-file\"></i><span>${file.name}</span>`;\n            }\n            \n            previewContainer.appendChild(item);\n        });\n    }\n    \n    processUploadedFiles() {\n        if (!this.uploadedFiles) return;\n        \n        this.uploadedFiles.forEach(file => {\n            const url = URL.createObjectURL(file);\n            \n            if (file.type.startsWith('image/')) {\n                this.addImageToContent(url, file.name);\n            } else if (file.type.startsWith('video/')) {\n                this.addVideoToContent(url, file.name);\n            }\n        });\n    }\n    \n    addImageToContent(url, name) {\n        const gallery = document.querySelector('.image-gallery');\n        const container = document.createElement('div');\n        container.className = 'image-container selectable-content';\n        container.dataset.type = 'image';\n        container.innerHTML = `\n            <img src=\"${url}\" alt=\"${name}\">\n            <span class=\"image-label\">${name}</span>\n        `;\n        gallery.appendChild(container);\n        this.selectionManager.registerElement(container);\n    }\n    \n    addVideoToContent(url, name) {\n        const gallery = document.querySelector('.video-gallery');\n        const container = document.createElement('div');\n        container.className = 'video-container selectable-content';\n        container.dataset.type = 'video';\n        container.innerHTML = `\n            <video src=\"${url}\" controls></video>\n            <span class=\"video-label\">${name}</span>\n        `;\n        gallery.appendChild(container);\n        this.selectionManager.registerElement(container);\n    }\n    \n    setupScreenCaptureHandlers() {\n        const captureBtn = document.getElementById('capture-screen-btn');\n        const overlay = document.getElementById('screen-capture-overlay');\n        const canvas = document.getElementById('capture-canvas');\n        \n        captureBtn.addEventListener('click', () => {\n            this.startScreenCapture();\n        });\n        \n        // Handle escape key\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && overlay.classList.contains('active')) {\n                overlay.classList.remove('active');\n            }\n        });\n        \n        // Canvas drawing for region selection\n        let isDrawing = false;\n        let startX, startY;\n        const ctx = canvas.getContext('2d');\n        \n        overlay.addEventListener('mousedown', (e) => {\n            isDrawing = true;\n            startX = e.clientX;\n            startY = e.clientY;\n        });\n        \n        overlay.addEventListener('mousemove', (e) => {\n            if (!isDrawing) return;\n            \n            canvas.width = window.innerWidth;\n            canvas.height = window.innerHeight;\n            \n            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n            \n            const width = e.clientX - startX;\n            const height = e.clientY - startY;\n            \n            ctx.clearRect(startX, startY, width, height);\n            ctx.strokeStyle = '#2563eb';\n            ctx.lineWidth = 2;\n            ctx.strokeRect(startX, startY, width, height);\n        });\n        \n        overlay.addEventListener('mouseup', async (e) => {\n            if (!isDrawing) return;\n            isDrawing = false;\n            \n            const width = e.clientX - startX;\n            const height = e.clientY - startY;\n            \n            if (Math.abs(width) > 10 && Math.abs(height) > 10) {\n                await this.captureRegion(startX, startY, width, height);\n            }\n            \n            overlay.classList.remove('active');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n        });\n    }\n    \n    async startScreenCapture() {\n        try {\n            // Request screen capture permission\n            const stream = await navigator.mediaDevices.getDisplayMedia({\n                video: { cursor: 'always' },\n                audio: false\n            });\n            \n            // Create video element to capture frame\n            const video = document.createElement('video');\n            video.srcObject = stream;\n            await video.play();\n            \n            // Create canvas and capture frame\n            const canvas = document.createElement('canvas');\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n            const ctx = canvas.getContext('2d');\n            ctx.drawImage(video, 0, 0);\n            \n            // Stop stream\n            stream.getTracks().forEach(track => track.stop());\n            \n            // Get image data\n            const imageUrl = canvas.toDataURL('image/png');\n            \n            // Add to content\n            this.addImageToContent(imageUrl, 'Screen Capture - ' + new Date().toLocaleTimeString());\n            \n            // Also set as current selection for analysis\n            this.selectionManager.setSelection({\n                type: 'screen',\n                content: imageUrl,\n                timestamp: Date.now()\n            });\n            \n            this.uiManager.showToast('success', 'Screen Captured', 'Screen capture added to content');\n            \n        } catch (error) {\n            console.error('Screen capture failed:', error);\n            this.uiManager.showToast('error', 'Capture Failed', 'Could not capture screen');\n        }\n    }\n    \n    async captureRegion(x, y, width, height) {\n        // This would capture a specific region\n        // For simplicity, we'll use the full screen capture approach\n        this.uiManager.showToast('info', 'Region Selected', `Region: ${Math.abs(width)}x${Math.abs(height)} pixels`);\n    }\n    \n    /**\n     * Setup handlers for \"Analyze Visible Content\" feature\n     * This captures the current tab/screen and extracts all content for analysis\n     */\n    setupTabAnalysisHandlers() {\n        const analyzeTabBtn = document.getElementById('analyze-tab-btn');\n        \n        analyzeTabBtn?.addEventListener('click', async () => {\n            await this.analyzeVisibleContent();\n        });\n    }\n    \n    /**\n     * Analyze all visible content in the current view\n     * Captures screen + extracts text + identifies images\n     */\n    async analyzeVisibleContent() {\n        this.uiManager.showToast('info', 'Capturing Content', 'Analyzing visible content...');\n        \n        try {\n            // Collect all content from the content display area\n            const contentDisplay = document.getElementById('content-display');\n            const collectedContent = {\n                text: [],\n                images: [],\n                timestamp: Date.now()\n            };\n            \n            // Extract all visible text\n            const textElements = contentDisplay.querySelectorAll('p, span, div, h1, h2, h3, h4, h5, h6, li, td, th');\n            textElements.forEach(el => {\n                const text = el.innerText?.trim();\n                if (text && text.length > 10) {\n                    collectedContent.text.push(text);\n                }\n            });\n            \n            // Extract all images\n            const images = contentDisplay.querySelectorAll('img');\n            images.forEach(img => {\n                if (img.src && !img.src.includes('data:image/svg+xml')) {\n                    collectedContent.images.push({\n                        src: img.src,\n                        alt: img.alt || 'Medical image'\n                    });\n                }\n            });\n            \n            // Also try to capture the screen for visual analysis\n            let screenCapture = null;\n            try {\n                screenCapture = await this.captureCurrentView();\n            } catch (e) {\n                console.log('Screen capture skipped:', e.message);\n            }\n            \n            // Combine all text for analysis\n            const combinedText = collectedContent.text.join('\\n\\n');\n            \n            if (combinedText.length < 20 && collectedContent.images.length === 0 && !screenCapture) {\n                this.uiManager.showToast('warning', 'No Content', 'No analyzable content found. Try loading patient data first.');\n                return;\n            }\n            \n            // Set as current selection\n            this.selectionManager.setSelection({\n                type: 'combined',\n                content: {\n                    text: combinedText,\n                    images: collectedContent.images,\n                    screenshot: screenCapture\n                },\n                position: { x: window.innerWidth / 2, y: 100 },\n                timestamp: Date.now()\n            });\n            \n            // Update preview\n            this.updateCombinedPreview(collectedContent, screenCapture);\n            \n            // Show analysis panel\n            document.getElementById('analysis-panel').classList.remove('hidden');\n            \n            this.uiManager.showToast('success', 'Content Captured', \n                `Found ${collectedContent.text.length} text sections and ${collectedContent.images.length} images`);\n            \n        } catch (error) {\n            console.error('Tab analysis error:', error);\n            this.uiManager.showToast('error', 'Capture Failed', 'Could not analyze visible content');\n        }\n    }\n    \n    async captureCurrentView() {\n        // Capture just the content area as an image\n        const contentDisplay = document.getElementById('content-display');\n        \n        // Use html2canvas approach (simplified version)\n        const canvas = document.createElement('canvas');\n        const rect = contentDisplay.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = Math.min(rect.height, 800);\n        \n        // For now, return null - in production you'd use html2canvas library\n        return null;\n    }\n    \n    updateCombinedPreview(content, screenshot) {\n        const previewArea = document.getElementById('preview-area');\n        \n        let html = '<div class=\"combined-preview\">';\n        \n        if (screenshot) {\n            html += `<img src=\"${screenshot}\" alt=\"Screen capture\" style=\"max-width:100%; margin-bottom:10px;\">`;\n        }\n        \n        if (content.text.length > 0) {\n            const previewText = content.text.slice(0, 3).join(' ').substring(0, 200);\n            html += `<div class=\"text-preview\"><strong>Text Content:</strong><br>${previewText}...</div>`;\n        }\n        \n        if (content.images.length > 0) {\n            html += `<div style=\"margin-top:8px;\"><strong>Images:</strong> ${content.images.length} medical image(s) found</div>`;\n        }\n        \n        html += '</div>';\n        previewArea.innerHTML = html;\n    }\n    \n    /**\n     * Setup handlers for loading external content (URLs, iframes)\n     */\n    setupExternalContentHandlers() {\n        const loadUrlBtn = document.getElementById('load-external-url');\n        const urlInput = document.getElementById('external-url');\n        \n        loadUrlBtn?.addEventListener('click', () => {\n            const url = urlInput.value.trim();\n            if (url) {\n                this.loadExternalContent(url);\n            } else {\n                this.uiManager.showToast('warning', 'No URL', 'Please enter a URL to load');\n            }\n        });\n        \n        urlInput?.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                loadUrlBtn.click();\n            }\n        });\n    }\n    \n    loadExternalContent(url) {\n        const container = document.getElementById('external-frame-container');\n        \n        // Note: Due to browser security (CORS), many sites won't load in iframe\n        // For production, you'd use a proxy server or browser extension\n        \n        container.innerHTML = `\n            <div class=\"external-content-notice\" style=\"padding: 1rem; background: #fef3c7; border-radius: 8px; margin-bottom: 1rem;\">\n                <i class=\"fas fa-info-circle\"></i>\n                <strong>Note:</strong> Due to browser security, some sites may not load in the frame. \n                Use \"Capture Screen\" to analyze content from any tab.\n            </div>\n            <iframe \n                src=\"${url}\" \n                sandbox=\"allow-same-origin allow-scripts\"\n                style=\"width:100%; height:400px; border:1px solid #e2e8f0; border-radius:8px;\">\n            </iframe>\n        `;\n        \n        this.uiManager.showToast('info', 'Loading URL', 'Attempting to load external content...');\n    }\n}\n","/**\n * Cache Manager - Handles IndexedDB storage for AI models and data\n * Enables offline functionality after first model download\n */\nexport class CacheManager {\n    constructor() {\n        this.dbName = 'AImedicalAssistantDB';\n        this.dbVersion = 1;\n        this.db = null;\n        this.stores = {\n            models: 'models',\n            settings: 'settings',\n            reports: 'reports'\n        };\n    }\n\n    /**\n     * Initialize IndexedDB connection\n     */\n    async initialize() {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.dbName, this.dbVersion);\n\n            request.onerror = () => {\n                console.error('Failed to open IndexedDB:', request.error);\n                reject(request.error);\n            };\n\n            request.onsuccess = () => {\n                this.db = request.result;\n                console.log(' CacheManager: IndexedDB initialized');\n                resolve(this.db);\n            };\n\n            request.onupgradeneeded = (event) => {\n                const db = event.target.result;\n\n                // Models store - for AI model files\n                if (!db.objectStoreNames.contains(this.stores.models)) {\n                    const modelsStore = db.createObjectStore(this.stores.models, { keyPath: 'id' });\n                    modelsStore.createIndex('name', 'name', { unique: false });\n                    modelsStore.createIndex('version', 'version', { unique: false });\n                    modelsStore.createIndex('timestamp', 'timestamp', { unique: false });\n                }\n\n                // Settings store - for app configuration\n                if (!db.objectStoreNames.contains(this.stores.settings)) {\n                    db.createObjectStore(this.stores.settings, { keyPath: 'key' });\n                }\n\n                // Reports store - for saved report drafts\n                if (!db.objectStoreNames.contains(this.stores.reports)) {\n                    const reportsStore = db.createObjectStore(this.stores.reports, { keyPath: 'id' });\n                    reportsStore.createIndex('patientId', 'patientId', { unique: false });\n                    reportsStore.createIndex('timestamp', 'timestamp', { unique: false });\n                }\n\n                console.log(' CacheManager: Database schema created');\n            };\n        });\n    }\n\n    /**\n     * Check if a model is cached\n     */\n    async isModelCached(modelId) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readonly');\n            const store = transaction.objectStore(this.stores.models);\n            const request = store.get(modelId);\n\n            request.onsuccess = () => {\n                resolve(!!request.result);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    /**\n     * Get cached model data\n     */\n    async getModel(modelId) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readonly');\n            const store = transaction.objectStore(this.stores.models);\n            const request = store.get(modelId);\n\n            request.onsuccess = () => {\n                resolve(request.result);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    /**\n     * Save model to cache\n     */\n    async saveModel(modelId, modelData, metadata = {}) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readwrite');\n            const store = transaction.objectStore(this.stores.models);\n\n            const record = {\n                id: modelId,\n                name: metadata.name || modelId,\n                version: metadata.version || '1.0.0',\n                data: modelData,\n                size: metadata.size || 0,\n                timestamp: Date.now(),\n                metadata\n            };\n\n            const request = store.put(record);\n\n            request.onsuccess = () => {\n                console.log(` Model cached: ${modelId}`);\n                resolve(record);\n            };\n\n            request.onerror = () => {\n                console.error(` Failed to cache model: ${modelId}`, request.error);\n                reject(request.error);\n            };\n        });\n    }\n\n    /**\n     * Delete model from cache\n     */\n    async deleteModel(modelId) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readwrite');\n            const store = transaction.objectStore(this.stores.models);\n            const request = store.delete(modelId);\n\n            request.onsuccess = () => {\n                console.log(` Model deleted: ${modelId}`);\n                resolve();\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    /**\n     * Get all cached models\n     */\n    async getAllModels() {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readonly');\n            const store = transaction.objectStore(this.stores.models);\n            const request = store.getAll();\n\n            request.onsuccess = () => {\n                resolve(request.result || []);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    /**\n     * Get total cache size\n     */\n    async getCacheSize() {\n        const models = await this.getAllModels();\n        return models.reduce((total, model) => total + (model.size || 0), 0);\n    }\n\n    /**\n     * Clear all cached models\n     */\n    async clearModelCache() {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.models], 'readwrite');\n            const store = transaction.objectStore(this.stores.models);\n            const request = store.clear();\n\n            request.onsuccess = () => {\n                console.log(' Model cache cleared');\n                resolve();\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    // Settings methods\n    async getSetting(key, defaultValue = null) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.settings], 'readonly');\n            const store = transaction.objectStore(this.stores.settings);\n            const request = store.get(key);\n\n            request.onsuccess = () => {\n                resolve(request.result?.value ?? defaultValue);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    async setSetting(key, value) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.settings], 'readwrite');\n            const store = transaction.objectStore(this.stores.settings);\n            const request = store.put({ key, value, timestamp: Date.now() });\n\n            request.onsuccess = () => {\n                resolve();\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    // Report methods\n    async saveReport(report) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.reports], 'readwrite');\n            const store = transaction.objectStore(this.stores.reports);\n            \n            report.timestamp = Date.now();\n            const request = store.put(report);\n\n            request.onsuccess = () => {\n                resolve(report);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    async getReport(reportId) {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.reports], 'readonly');\n            const store = transaction.objectStore(this.stores.reports);\n            const request = store.get(reportId);\n\n            request.onsuccess = () => {\n                resolve(request.result);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    async getAllReports() {\n        if (!this.db) await this.initialize();\n\n        return new Promise((resolve, reject) => {\n            const transaction = this.db.transaction([this.stores.reports], 'readonly');\n            const store = transaction.objectStore(this.stores.reports);\n            const request = store.getAll();\n\n            request.onsuccess = () => {\n                resolve(request.result || []);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n}\n\n// Singleton instance\nexport const cacheManager = new CacheManager();\n","/**\n * Offline Manager - Detects network status and manages offline mode\n * Ensures app works seamlessly with or without internet connection\n */\nexport class OfflineManager {\n    constructor() {\n        this.isOnline = navigator.onLine;\n        this.listeners = new Map();\n        this.offlineQueue = [];\n        this.initialize();\n    }\n\n    initialize() {\n        // Listen for online/offline events\n        window.addEventListener('online', () => this.handleOnline());\n        window.addEventListener('offline', () => this.handleOffline());\n\n        // Check connection periodically (every 30 seconds)\n        setInterval(() => this.checkConnection(), 30000);\n\n        console.log(` OfflineManager: Initialized (${this.isOnline ? 'Online' : 'Offline'})`);\n    }\n\n    handleOnline() {\n        this.isOnline = true;\n        console.log(' Network: Online');\n        this.emit('online');\n        this.processOfflineQueue();\n    }\n\n    handleOffline() {\n        this.isOnline = false;\n        console.log(' Network: Offline');\n        this.emit('offline');\n    }\n\n    /**\n     * Check actual network connectivity (not just navigator.onLine)\n     */\n    async checkConnection() {\n        try {\n            // Try to fetch a small resource\n            const response = await fetch('https://www.google.com/favicon.ico', {\n                method: 'HEAD',\n                mode: 'no-cors',\n                cache: 'no-cache'\n            });\n            \n            if (!this.isOnline) {\n                this.handleOnline();\n            }\n            return true;\n        } catch (error) {\n            if (this.isOnline) {\n                this.handleOffline();\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Get current network status\n     */\n    getStatus() {\n        return {\n            isOnline: this.isOnline,\n            effectiveType: navigator.connection?.effectiveType || 'unknown',\n            downlink: navigator.connection?.downlink || 'unknown',\n            saveData: navigator.connection?.saveData || false\n        };\n    }\n\n    /**\n     * Check if we're on a slow connection\n     */\n    isSlowConnection() {\n        const connection = navigator.connection;\n        if (!connection) return false;\n        \n        return connection.saveData || \n               connection.effectiveType === 'slow-2g' || \n               connection.effectiveType === '2g';\n    }\n\n    /**\n     * Queue action for when online\n     */\n    queueForOnline(action, data) {\n        this.offlineQueue.push({\n            action,\n            data,\n            timestamp: Date.now()\n        });\n        console.log(` Queued action for online: ${action}`);\n    }\n\n    /**\n     * Process queued actions when back online\n     */\n    async processOfflineQueue() {\n        if (!this.isOnline || this.offlineQueue.length === 0) return;\n\n        console.log(` Processing ${this.offlineQueue.length} queued actions...`);\n\n        while (this.offlineQueue.length > 0) {\n            const item = this.offlineQueue.shift();\n            try {\n                this.emit('processQueuedAction', item);\n            } catch (error) {\n                console.error('Error processing queued action:', error);\n                // Re-queue if failed\n                this.offlineQueue.unshift(item);\n                break;\n            }\n        }\n\n        console.log(' Offline queue processed');\n    }\n\n    /**\n     * Fetch with offline fallback\n     */\n    async fetchWithFallback(url, options = {}, fallbackData = null) {\n        if (!this.isOnline) {\n            if (fallbackData) {\n                return { data: fallbackData, fromCache: true };\n            }\n            throw new Error('No internet connection and no cached data available');\n        }\n\n        try {\n            const response = await fetch(url, {\n                ...options,\n                // Add timeout\n                signal: AbortSignal.timeout(options.timeout || 30000)\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP error: ${response.status}`);\n            }\n\n            return { data: await response.json(), fromCache: false };\n        } catch (error) {\n            if (fallbackData) {\n                console.warn('Fetch failed, using fallback:', error.message);\n                return { data: fallbackData, fromCache: true };\n            }\n            throw error;\n        }\n    }\n\n    // Event system\n    on(event, callback) {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        this.listeners.get(event).push(callback);\n    }\n\n    off(event, callback) {\n        if (this.listeners.has(event)) {\n            const callbacks = this.listeners.get(event);\n            const index = callbacks.indexOf(callback);\n            if (index > -1) {\n                callbacks.splice(index, 1);\n            }\n        }\n    }\n\n    emit(event, data) {\n        if (this.listeners.has(event)) {\n            this.listeners.get(event).forEach(callback => callback(data));\n        }\n    }\n}\n\n// Singleton instance\nexport const offlineManager = new OfflineManager();\n","/**\n * Configuration Manager - Centralized app configuration\n * Handles settings, feature flags, and environment-specific config\n */\n\n// ============================================\n// CLINICAL CONTEXT FILTERS\n// ============================================\n\n// Specialty configurations with specific vocabulary and analysis focus\nexport const SPECIALTIES = {\n    ent: {\n        id: 'ent',\n        name: 'ENT (Ear, Nose, Throat)',\n        icon: '',\n        reportTypes: ['audiometry', 'tympanometry', 'laryngoscopy', 'nasendoscopy', 'ct_sinus', 'ct_temporal', 'mri_iac', 'sleep_study'],\n        focusAreas: ['ear', 'nose', 'throat', 'sinus', 'larynx', 'pharynx', 'tympanic', 'cochlea', 'vestibular']\n    },\n    dental: {\n        id: 'dental',\n        name: 'Dental / Oral Health',\n        icon: '',\n        reportTypes: ['panoramic_xray', 'periapical_xray', 'cbct', 'periodontal_chart', 'intraoral_photo', 'dental_exam'],\n        focusAreas: ['teeth', 'gums', 'jaw', 'mandible', 'maxilla', 'tmj', 'occlusion', 'periodontal']\n    },\n    dermatology: {\n        id: 'dermatology',\n        name: 'Dermatology / Skin',\n        icon: '',\n        reportTypes: ['dermoscopy', 'skin_biopsy', 'patch_test', 'skin_photo', 'wound_assessment', 'mole_mapping'],\n        focusAreas: ['skin', 'lesion', 'rash', 'melanoma', 'nevus', 'dermatitis', 'wound', 'ulcer']\n    },\n    pediatrics: {\n        id: 'pediatrics',\n        name: 'Pediatrics (Head-to-Toe)',\n        icon: '',\n        reportTypes: ['well_child_exam', 'growth_chart', 'developmental_screen', 'immunization_record', 'newborn_exam', 'school_physical'],\n        focusAreas: ['growth', 'development', 'milestones', 'vaccination', 'fontanelle', 'reflexes', 'feeding', 'behavior'],\n        subSystems: {\n            head: ['fontanelle', 'skull_shape', 'head_circumference', 'craniosynostosis', 'plagiocephaly', 'scalp'],\n            eyes: ['red_reflex', 'strabismus', 'nystagmus', 'conjunctivitis', 'blocked_tear_duct', 'pupil_response'],\n            ears: ['otitis_media', 'ear_canal', 'hearing_screen', 'ear_position', 'preauricular_pit', 'cerumen'],\n            nose: ['nasal_patency', 'nasal_discharge', 'choanal_atresia', 'congestion'],\n            mouth: ['cleft_lip', 'cleft_palate', 'tongue_tie', 'thrush', 'teething', 'tooth_decay', 'tonsils'],\n            neck: ['torticollis', 'lymphadenopathy', 'thyroid', 'cystic_hygroma', 'branchial_cleft'],\n            chest: ['heart_murmur', 'breath_sounds', 'chest_shape', 'retractions', 'wheezing', 'stridor'],\n            abdomen: ['umbilical_hernia', 'inguinal_hernia', 'hepatomegaly', 'splenomegaly', 'constipation', 'colic'],\n            genitourinary: ['hypospadias', 'cryptorchidism', 'hydrocele', 'labial_adhesion', 'diaper_rash', 'phimosis'],\n            spine: ['sacral_dimple', 'scoliosis', 'kyphosis', 'spina_bifida', 'tethered_cord'],\n            extremities: ['hip_dysplasia', 'clubfoot', 'polydactyly', 'syndactyly', 'limb_length', 'gait'],\n            skin: ['birthmarks', 'hemangioma', 'mongolian_spot', 'eczema', 'diaper_dermatitis', 'jaundice', 'milia'],\n            neuro: ['tone', 'reflexes', 'moro_reflex', 'grasp_reflex', 'developmental_delay', 'seizures', 'head_lag']\n        }\n    },\n    womens_health: {\n        id: 'womens_health',\n        name: \"Women's Health & Fertility\",\n        icon: '',\n        reportTypes: ['pelvic_exam', 'pap_smear', 'mammogram', 'pelvic_ultrasound', 'transvaginal_ultrasound', 'hsg', 'fertility_labs', 'prenatal_visit'],\n        focusAreas: ['gynecology', 'obstetrics', 'fertility', 'menstrual', 'pregnancy', 'breast', 'ovarian', 'uterine'],\n        subCategories: {\n            gynecology: ['pelvic_exam', 'pap_smear', 'colposcopy', 'cervical', 'vaginal', 'vulvar', 'sti_screening'],\n            breast_health: ['mammogram', 'breast_ultrasound', 'breast_exam', 'lump', 'nipple_discharge', 'mastalgia'],\n            menstrual: ['dysmenorrhea', 'amenorrhea', 'menorrhagia', 'oligomenorrhea', 'pms', 'pmdd', 'cycle_tracking'],\n            fertility: ['ovulation', 'amh', 'fsh', 'lh', 'estradiol', 'progesterone', 'sperm_analysis', 'hsg', 'ivf', 'iui', 'egg_reserve'],\n            pregnancy: ['prenatal', 'trimester', 'fetal_heart', 'ultrasound', 'gestational_age', 'fundal_height', 'fetal_movement'],\n            menopause: ['perimenopause', 'hot_flashes', 'hrt', 'bone_density', 'vaginal_atrophy', 'hormone_levels'],\n            conditions: ['pcos', 'endometriosis', 'fibroids', 'ovarian_cyst', 'pid', 'vaginitis', 'cervicitis', 'prolapse']\n        }\n    },\n    vitals: {\n        id: 'vitals',\n        name: 'Vitals & General',\n        icon: '',\n        reportTypes: ['vital_signs', 'ecg', 'blood_pressure', 'pulse_oximetry', 'temperature', 'bmi_assessment'],\n        focusAreas: ['heart_rate', 'blood_pressure', 'temperature', 'respiratory_rate', 'oxygen', 'weight', 'bmi']\n    },\n    cardiology: {\n        id: 'cardiology',\n        name: 'Cardiology',\n        icon: '',\n        reportTypes: ['ecg_12lead', 'echocardiogram', 'holter', 'stress_test', 'ct_angio', 'cardiac_mri'],\n        focusAreas: ['heart', 'cardiac', 'arrhythmia', 'murmur', 'valve', 'coronary', 'ejection_fraction']\n    },\n    radiology: {\n        id: 'radiology',\n        name: 'Radiology / Imaging',\n        icon: '',\n        reportTypes: ['xray', 'ct_scan', 'mri', 'ultrasound', 'pet_scan', 'mammogram', 'dexa_scan'],\n        focusAreas: ['opacity', 'mass', 'fracture', 'lesion', 'nodule', 'effusion', 'consolidation']\n    },\n    gastro: {\n        id: 'gastro',\n        name: 'Gastroenterology',\n        icon: '',\n        reportTypes: ['endoscopy', 'colonoscopy', 'ultrasound_abdomen', 'ct_abdomen', 'liver_function', 'h_pylori'],\n        focusAreas: ['stomach', 'intestine', 'liver', 'pancreas', 'gallbladder', 'colon', 'esophagus']\n    }\n};\n\n// Age group configurations for age-appropriate analysis\nexport const AGE_GROUPS = {\n    neonate: {\n        id: 'neonate',\n        name: 'Neonate (0-28 days)',\n        range: [0, 0.08], // years\n        considerations: ['neonatal_vitals', 'congenital', 'birth_related', 'feeding']\n    },\n    infant: {\n        id: 'infant',\n        name: 'Infant (1-12 months)',\n        range: [0.08, 1],\n        considerations: ['developmental_milestones', 'vaccination', 'growth', 'feeding']\n    },\n    toddler: {\n        id: 'toddler',\n        name: 'Toddler (1-3 years)',\n        range: [1, 3],\n        considerations: ['developmental', 'behavioral', 'growth', 'immunization']\n    },\n    child: {\n        id: 'child',\n        name: 'Child (3-12 years)',\n        range: [3, 12],\n        considerations: ['growth', 'school_health', 'behavioral', 'dental_development']\n    },\n    adolescent: {\n        id: 'adolescent',\n        name: 'Adolescent (12-18 years)',\n        range: [12, 18],\n        considerations: ['puberty', 'mental_health', 'sports_injuries', 'acne']\n    },\n    adult: {\n        id: 'adult',\n        name: 'Adult (18-65 years)',\n        range: [18, 65],\n        considerations: ['lifestyle', 'chronic_disease', 'screening', 'occupational']\n    },\n    elderly: {\n        id: 'elderly',\n        name: 'Elderly (65+ years)',\n        range: [65, 150],\n        considerations: ['geriatric', 'polypharmacy', 'fall_risk', 'cognitive', 'hearing_loss']\n    }\n};\n\n// Report type configurations with specific analysis parameters\nexport const REPORT_TYPES = {\n    // ENT Reports\n    audiometry: { name: 'Audiometry', specialty: 'ent', dataType: 'waveform', icon: '' },\n    tympanometry: { name: 'Tympanometry', specialty: 'ent', dataType: 'waveform', icon: '' },\n    laryngoscopy: { name: 'Laryngoscopy', specialty: 'ent', dataType: 'video', icon: '' },\n    nasendoscopy: { name: 'Nasendoscopy', specialty: 'ent', dataType: 'video', icon: '' },\n    ct_sinus: { name: 'CT Sinus', specialty: 'ent', dataType: 'image', icon: '' },\n    ct_temporal: { name: 'CT Temporal Bone', specialty: 'ent', dataType: 'image', icon: '' },\n    \n    // Dental Reports\n    panoramic_xray: { name: 'Panoramic X-Ray (OPG)', specialty: 'dental', dataType: 'image', icon: '' },\n    periapical_xray: { name: 'Periapical X-Ray', specialty: 'dental', dataType: 'image', icon: '' },\n    cbct: { name: 'CBCT (3D Dental)', specialty: 'dental', dataType: 'image', icon: '' },\n    periodontal_chart: { name: 'Periodontal Chart', specialty: 'dental', dataType: 'structured', icon: '' },\n    intraoral_photo: { name: 'Intraoral Photo', specialty: 'dental', dataType: 'image', icon: '' },\n    \n    // Dermatology Reports\n    dermoscopy: { name: 'Dermoscopy', specialty: 'dermatology', dataType: 'image', icon: '' },\n    skin_biopsy: { name: 'Skin Biopsy Report', specialty: 'dermatology', dataType: 'text', icon: '' },\n    skin_photo: { name: 'Clinical Skin Photo', specialty: 'dermatology', dataType: 'image', icon: '' },\n    wound_assessment: { name: 'Wound Assessment', specialty: 'dermatology', dataType: 'combined', icon: '' },\n    \n    // Vitals Reports\n    vital_signs: { name: 'Vital Signs', specialty: 'vitals', dataType: 'structured', icon: '' },\n    ecg: { name: 'ECG/EKG', specialty: 'vitals', dataType: 'waveform', icon: '' },\n    blood_pressure: { name: 'Blood Pressure Log', specialty: 'vitals', dataType: 'structured', icon: '' },\n    \n    // Cardiology Reports\n    ecg_12lead: { name: '12-Lead ECG', specialty: 'cardiology', dataType: 'waveform', icon: '' },\n    echocardiogram: { name: 'Echocardiogram', specialty: 'cardiology', dataType: 'video', icon: '' },\n    holter: { name: 'Holter Monitor', specialty: 'cardiology', dataType: 'waveform', icon: '' },\n    \n    // Radiology Reports\n    xray: { name: 'X-Ray', specialty: 'radiology', dataType: 'image', icon: '' },\n    ct_scan: { name: 'CT Scan', specialty: 'radiology', dataType: 'image', icon: '' },\n    mri: { name: 'MRI', specialty: 'radiology', dataType: 'image', icon: '' },\n    ultrasound: { name: 'Ultrasound', specialty: 'radiology', dataType: 'image', icon: '' },\n    ultrasound_abdomen: { name: 'Ultrasound Abdomen', specialty: 'gastro', dataType: 'image', icon: '' },\n    \n    // Gastro Reports\n    endoscopy: { name: 'Endoscopy', specialty: 'gastro', dataType: 'video', icon: '' },\n    colonoscopy: { name: 'Colonoscopy', specialty: 'gastro', dataType: 'video', icon: '' },\n    \n    // Pediatric Reports\n    well_child_exam: { name: 'Well Child Exam', specialty: 'pediatrics', dataType: 'text', icon: '' },\n    growth_chart: { name: 'Growth Chart', specialty: 'pediatrics', dataType: 'structured', icon: '' },\n    developmental_screen: { name: 'Developmental Screening', specialty: 'pediatrics', dataType: 'structured', icon: '' },\n    immunization_record: { name: 'Immunization Record', specialty: 'pediatrics', dataType: 'structured', icon: '' },\n    newborn_exam: { name: 'Newborn Examination', specialty: 'pediatrics', dataType: 'text', icon: '' },\n    school_physical: { name: 'School Physical', specialty: 'pediatrics', dataType: 'text', icon: '' },\n    pediatric_neuro: { name: 'Pediatric Neuro Exam', specialty: 'pediatrics', dataType: 'text', icon: '' },\n    \n    // Women's Health Reports\n    pelvic_exam: { name: 'Pelvic Examination', specialty: 'womens_health', dataType: 'text', icon: '' },\n    pap_smear: { name: 'Pap Smear / Cervical Screen', specialty: 'womens_health', dataType: 'text', icon: '' },\n    mammogram: { name: 'Mammogram', specialty: 'womens_health', dataType: 'image', icon: '' },\n    pelvic_ultrasound: { name: 'Pelvic Ultrasound', specialty: 'womens_health', dataType: 'image', icon: '' },\n    transvaginal_ultrasound: { name: 'Transvaginal Ultrasound', specialty: 'womens_health', dataType: 'image', icon: '' },\n    hsg: { name: 'HSG (Hysterosalpingogram)', specialty: 'womens_health', dataType: 'image', icon: '' },\n    fertility_labs: { name: 'Fertility Lab Results', specialty: 'womens_health', dataType: 'structured', icon: '' },\n    prenatal_visit: { name: 'Prenatal Visit', specialty: 'womens_health', dataType: 'text', icon: '' },\n    fetal_ultrasound: { name: 'Fetal Ultrasound', specialty: 'womens_health', dataType: 'image', icon: '' },\n    breast_ultrasound: { name: 'Breast Ultrasound', specialty: 'womens_health', dataType: 'image', icon: '' },\n    colposcopy: { name: 'Colposcopy', specialty: 'womens_health', dataType: 'image', icon: '' },\n    \n    // General\n    clinical_notes: { name: 'Clinical Notes', specialty: 'general', dataType: 'text', icon: '' },\n    lab_results: { name: 'Lab Results', specialty: 'general', dataType: 'structured', icon: '' },\n    prescription: { name: 'Prescription', specialty: 'general', dataType: 'text', icon: '' }\n};\n\n// Gender options for demographic context\nexport const GENDER_OPTIONS = {\n    male: { id: 'male', name: 'Male', icon: '' },\n    female: { id: 'female', name: 'Female', icon: '' },\n    other: { id: 'other', name: 'Other', icon: '' },\n    not_specified: { id: 'not_specified', name: 'Not Specified', icon: '' }\n};\n\n// ============================================\n// MODEL CONFIGURATIONS\n// ============================================\n\n// Model configurations with metadata\nexport const MODELS = {\n    textClassification: {\n        id: 'Xenova/distilbert-base-uncased-finetuned-sst-2-english',\n        name: 'Text Classifier',\n        task: 'sentiment-analysis',\n        size: 250 * 1024 * 1024, // 250MB\n        description: 'General text classification and sentiment analysis',\n        priority: 1, // Load first\n        required: true\n    },\n    medicalNER: {\n        id: 'Xenova/bert-base-NER',\n        name: 'Medical NER',\n        task: 'token-classification',\n        size: 420 * 1024 * 1024, // 420MB\n        description: 'Named entity recognition for medical terms',\n        priority: 2,\n        required: false\n    },\n    textGeneration: {\n        id: 'Xenova/flan-t5-small',\n        name: 'Text Generator',\n        task: 'text2text-generation',\n        size: 300 * 1024 * 1024, // 300MB\n        description: 'Generate medical summaries and insights',\n        priority: 3,\n        required: false\n    },\n    imageClassification: {\n        id: 'Xenova/vit-base-patch16-224',\n        name: 'Image Classifier',\n        task: 'image-classification',\n        size: 350 * 1024 * 1024, // 350MB\n        description: 'Analyze medical images',\n        priority: 4,\n        required: false\n    }\n};\n\n// ============================================\n// SPECIALTY-SPECIFIC MEDICAL VOCABULARY\n// ============================================\n\n// Medical vocabulary for enhanced analysis\nexport const MEDICAL_VOCABULARY = {\n    ent: [\n        'sinusitis', 'rhinitis', 'otitis', 'tonsillitis', 'pharyngitis',\n        'laryngitis', 'adenoid', 'polyp', 'septum', 'deviated', 'turbinate',\n        'eustachian', 'tympanic', 'cochlea', 'vestibular', 'vertigo',\n        'tinnitus', 'hearing loss', 'audiometry', 'endoscopy', 'laryngoscopy',\n        'sensorineural', 'conductive', 'mixed hearing loss', 'cholesteatoma',\n        'mastoiditis', 'labyrinthitis', 'meniere', 'acoustic neuroma'\n    ],\n    dental: [\n        'cavity', 'caries', 'enamel', 'dentin', 'pulp', 'root canal',\n        'periodontal', 'gingivitis', 'periodontitis', 'plaque', 'tartar',\n        'crown', 'bridge', 'implant', 'extraction', 'filling', 'amalgam',\n        'composite', 'veneer', 'orthodontic', 'malocclusion', 'bruxism',\n        'tmj', 'temporomandibular', 'occlusion', 'bite', 'mandible', 'maxilla',\n        'abscess', 'impacted', 'wisdom tooth', 'endodontic', 'prosthodontic'\n    ],\n    dermatology: [\n        'melanoma', 'nevus', 'mole', 'lesion', 'papule', 'macule', 'nodule',\n        'vesicle', 'pustule', 'plaque', 'dermatitis', 'eczema', 'psoriasis',\n        'urticaria', 'hives', 'rash', 'erythema', 'pigmentation', 'acne',\n        'rosacea', 'alopecia', 'vitiligo', 'cellulitis', 'abscess', 'ulcer',\n        'wound', 'laceration', 'abrasion', 'burn', 'scar', 'keloid',\n        'basal cell', 'squamous cell', 'keratosis', 'dermoscopy', 'biopsy'\n    ],\n    vitals: [\n        'blood pressure', 'systolic', 'diastolic', 'hypertension', 'hypotension',\n        'heart rate', 'pulse', 'bradycardia', 'tachycardia', 'arrhythmia',\n        'temperature', 'fever', 'hypothermia', 'hyperthermia',\n        'respiratory rate', 'tachypnea', 'bradypnea', 'dyspnea',\n        'oxygen saturation', 'spo2', 'hypoxia', 'cyanosis',\n        'bmi', 'weight', 'height', 'obesity', 'underweight', 'malnutrition'\n    ],\n    cardiology: [\n        'ecg', 'ekg', 'electrocardiogram', 'qrs', 'st segment', 'p wave', 't wave',\n        'atrial fibrillation', 'afib', 'flutter', 'pvc', 'pac',\n        'murmur', 'systolic', 'diastolic', 'regurgitation', 'stenosis',\n        'ejection fraction', 'lvef', 'cardiomyopathy', 'heart failure',\n        'coronary', 'angina', 'infarction', 'mi', 'stemi', 'nstemi',\n        'pericarditis', 'endocarditis', 'valve', 'mitral', 'aortic', 'tricuspid'\n    ],\n    general: [\n        'inflammation', 'infection', 'lesion', 'tumor', 'cyst', 'abscess',\n        'edema', 'erythema', 'necrosis', 'biopsy', 'pathology', 'diagnosis',\n        'prognosis', 'acute', 'chronic', 'benign', 'malignant', 'metastasis',\n        'bilateral', 'unilateral', 'proximal', 'distal', 'anterior', 'posterior'\n    ]\n};\n\n// ============================================\n// ANALYSIS CONTEXT BUILDER\n// ============================================\n\n/**\n * Build analysis context from user-selected filters\n * This context is passed to the AI for more accurate analysis\n */\nexport function buildAnalysisContext(filters) {\n    const context = {\n        specialty: null,\n        ageGroup: null,\n        reportType: null,\n        gender: null,\n        vocabulary: [],\n        focusAreas: [],\n        considerations: [],\n        dataType: 'text'\n    };\n    \n    // Set specialty context\n    if (filters.specialty && SPECIALTIES[filters.specialty]) {\n        const spec = SPECIALTIES[filters.specialty];\n        context.specialty = spec;\n        context.focusAreas = spec.focusAreas;\n        context.vocabulary = MEDICAL_VOCABULARY[filters.specialty] || MEDICAL_VOCABULARY.general;\n    }\n    \n    // Set age group context\n    if (filters.ageGroup && AGE_GROUPS[filters.ageGroup]) {\n        const age = AGE_GROUPS[filters.ageGroup];\n        context.ageGroup = age;\n        context.considerations = age.considerations;\n    }\n    \n    // Set report type context\n    if (filters.reportType && REPORT_TYPES[filters.reportType]) {\n        const report = REPORT_TYPES[filters.reportType];\n        context.reportType = report;\n        context.dataType = report.dataType;\n    }\n    \n    // Set gender context\n    if (filters.gender && GENDER_OPTIONS[filters.gender]) {\n        context.gender = GENDER_OPTIONS[filters.gender];\n    }\n    \n    return context;\n}\n\n/**\n * Get relevant vocabulary for the given context\n */\nexport function getContextVocabulary(context) {\n    const vocab = new Set();\n    \n    // Add specialty vocabulary\n    if (context.specialty) {\n        const specVocab = MEDICAL_VOCABULARY[context.specialty.id] || [];\n        specVocab.forEach(term => vocab.add(term));\n    }\n    \n    // Always include general medical terms\n    MEDICAL_VOCABULARY.general.forEach(term => vocab.add(term));\n    \n    return Array.from(vocab);\n}\n\n// ============================================\n// APPLICATION CONFIGURATION\n// ============================================\n\n// Application configuration\nexport const CONFIG = {\n    app: {\n        name: 'Medical AI Assistant',\n        version: '1.0.0',\n        environment: import.meta.env?.MODE || 'development'\n    },\n    \n    // Model loading settings\n    models: {\n        downloadTimeout: 5 * 60 * 1000, // 5 minutes\n        retryAttempts: 3,\n        retryDelay: 2000, // 2 seconds\n        cacheExpiration: 30 * 24 * 60 * 60 * 1000, // 30 days\n        progressUpdateInterval: 100 // ms\n    },\n    \n    // Analysis settings\n    analysis: {\n        maxTextLength: 50000, // characters\n        maxImageSize: 10 * 1024 * 1024, // 10MB\n        maxVideoLength: 300, // 5 minutes in seconds\n        defaultConfidenceThreshold: 0.5,\n        batchSize: 10\n    },\n    \n    // UI settings\n    ui: {\n        toastDuration: 3000,\n        modalAnimationDuration: 200,\n        debounceDelay: 300,\n        maxRecentReports: 50\n    },\n    \n    // Storage settings\n    storage: {\n        dbName: 'MedicalAIAssistant',\n        dbVersion: 1,\n        maxCacheSize: 2 * 1024 * 1024 * 1024, // 2GB\n        quotaWarningThreshold: 0.9 // Warn at 90% capacity\n    },\n    \n    // Feature flags\n    features: {\n        enableImageAnalysis: true,\n        enableVideoAnalysis: true,\n        enableScreenCapture: true\n    },\n    \n    // API endpoints (for future cloud integration)\n    api: {\n        baseUrl: import.meta.env?.VITE_API_URL || '',\n        reportSubmissionEndpoint: '/api/reports',\n        modelDownloadEndpoint: 'https://huggingface.co'\n    }\n};\n\n// Get total required model size\nexport function getTotalModelSize(requiredOnly = false) {\n    return Object.values(MODELS)\n        .filter(model => !requiredOnly || model.required)\n        .reduce((total, model) => total + model.size, 0);\n}\n\n// Format bytes to human readable\nexport function formatBytes(bytes) {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n// Check if feature is enabled\nexport function isFeatureEnabled(featureName) {\n    return CONFIG.features[featureName] ?? false;\n}\n\n// Get environment-specific value\nexport function getEnvConfig(key, defaultValue) {\n    if (typeof import.meta.env !== 'undefined') {\n        return import.meta.env[`VITE_${key}`] || defaultValue;\n    }\n    return defaultValue;\n}\n\nexport default CONFIG;\n","/**\n * AI Model Manager - Production Ready\n * Handles loading and running AI models locally in the browser\n * Uses Transformers.js for local inference with IndexedDB caching\n */\nimport { cacheManager } from '../core/CacheManager.js';\nimport { offlineManager } from '../core/OfflineManager.js';\nimport { MODELS, CONFIG, MEDICAL_VOCABULARY, formatBytes } from '../core/ConfigManager.js';\n\nexport class ModelManager {\n    constructor() {\n        this.models = new Map();\n        this.pipelines = new Map();\n        this.isInitialized = false;\n        this.useLocalModel = true;\n        this.loadingState = {\n            total: 0,\n            loaded: 0,\n            currentModel: null,\n            errors: []\n        };\n        \n        // Model configuration from ConfigManager\n        this.modelConfig = MODELS;\n        \n        // Transformers.js module reference\n        this.transformers = null;\n    }\n    \n    /**\n     * Initialize models with intelligent caching\n     * @param {Function} progressCallback - Progress update callback\n     * @param {Object} options - Loading options\n     */\n    async initialize(progressCallback, options = {}) {\n        if (this.isInitialized) return { success: true, cached: true };\n        \n        const { \n            loadRequired = true,\n            loadOptional = false,\n            forceDownload = false \n        } = options;\n        \n        try {\n            // Initialize cache first\n            await cacheManager.initialize();\n            \n            // Import Transformers.js\n            this.transformers = await import('@xenova/transformers');\n            const { pipeline, env } = this.transformers;\n            \n            // Configure for browser environment with caching\n            env.allowLocalModels = false;\n            env.useBrowserCache = true;\n            env.cacheDir = '.cache'; // Browser cache directory\n            \n            // Determine which models to load\n            const modelsToLoad = Object.entries(MODELS)\n                .filter(([_, model]) => {\n                    if (loadRequired && model.required) return true;\n                    if (loadOptional && !model.required) return true;\n                    return false;\n                })\n                .sort((a, b) => a[1].priority - b[1].priority);\n            \n            this.loadingState.total = modelsToLoad.length;\n            \n            // Load models with progress tracking\n            for (let i = 0; i < modelsToLoad.length; i++) {\n                const [modelKey, modelConfig] = modelsToLoad[i];\n                this.loadingState.currentModel = modelConfig.name;\n                \n                try {\n                    await this.loadModel(modelKey, modelConfig, (modelProgress) => {\n                        // Calculate overall progress\n                        const baseProgress = i / modelsToLoad.length;\n                        const modelContribution = modelProgress / modelsToLoad.length;\n                        const totalProgress = baseProgress + modelContribution;\n                        \n                        if (progressCallback) {\n                            progressCallback({\n                                overall: totalProgress,\n                                modelProgress: modelProgress,\n                                currentModel: modelConfig.name,\n                                modelsLoaded: i,\n                                totalModels: modelsToLoad.length\n                            });\n                        }\n                    }, forceDownload);\n                    \n                    this.loadingState.loaded++;\n                } catch (error) {\n                    console.error(`Failed to load model ${modelKey}:`, error);\n                    this.loadingState.errors.push({ model: modelKey, error: error.message });\n                    \n                    // Continue with other models if this one fails\n                    if (modelConfig.required) {\n                        throw new Error(`Required model ${modelKey} failed to load: ${error.message}`);\n                    }\n                }\n            }\n            \n            this.isInitialized = true;\n            if (progressCallback) progressCallback({ overall: 1, complete: true });\n            \n            console.log(' AI Models loaded successfully', {\n                loaded: this.loadingState.loaded,\n                total: this.loadingState.total,\n                errors: this.loadingState.errors.length\n            });\n            \n            return {\n                success: true,\n                loaded: this.loadingState.loaded,\n                errors: this.loadingState.errors\n            };\n            \n        } catch (error) {\n            console.warn('Could not load Transformers.js models, using fallback mode:', error);\n            this.useLocalModel = false;\n            this.isInitialized = true;\n            if (progressCallback) progressCallback({ overall: 1, complete: true, fallback: true });\n            \n            return {\n                success: false,\n                fallback: true,\n                error: error.message\n            };\n        }\n    }\n    \n    /**\n     * Load a single model with caching support\n     */\n    async loadModel(modelKey, modelConfig, progressCallback, forceDownload = false) {\n        const { pipeline } = this.transformers;\n        const modelId = modelConfig.id;\n        \n        // Check cache first (unless forcing download)\n        if (!forceDownload) {\n            const cached = await cacheManager.isModelCached(modelId);\n            if (cached) {\n                console.log(` Loading ${modelConfig.name} from cache...`);\n            }\n        }\n        \n        // Load model with progress tracking\n        const loadedPipeline = await pipeline(modelConfig.task, modelId, {\n            progress_callback: (progress) => {\n                if (progress.status === 'progress' && progress.progress !== undefined) {\n                    progressCallback(progress.progress / 100);\n                } else if (progress.status === 'done') {\n                    progressCallback(1);\n                }\n            }\n        });\n        \n        // Store reference\n        this.pipelines.set(modelKey, loadedPipeline);\n        \n        // Update cache metadata\n        await cacheManager.saveModel(modelId, {\n            key: modelKey,\n            config: modelConfig,\n            loadedAt: Date.now()\n        });\n        \n        console.log(` Loaded: ${modelConfig.name}`);\n        return loadedPipeline;\n    }\n    \n    /**\n     * Get pipeline for a specific task\n     */\n    getPipeline(modelKey) {\n        return this.pipelines.get(modelKey);\n    }\n    \n    /**\n     * Analyze text with optional clinical context\n     * @param {string} text - Text to analyze\n     * @param {string} analysisType - Type of analysis (diagnosis, summary, findings, recommendations)\n     * @param {Object} clinicalContext - Optional clinical context filters\n     */\n    async analyzeText(text, analysisType, clinicalContext = null) {\n        if (!text || text.trim().length === 0) {\n            throw new Error('No text provided for analysis');\n        }\n        \n        // Truncate if too long\n        const maxLength = CONFIG.analysis.maxTextLength;\n        const processedText = text.length > maxLength ? text.substring(0, maxLength) : text;\n        \n        // If local model is available, use it\n        if (this.useLocalModel && this.pipelines.has('textClassification')) {\n            try {\n                const classifier = this.pipelines.get('textClassification');\n                const classification = await classifier(processedText.substring(0, 512));\n                return this.generateMedicalAnalysis(processedText, classification, analysisType, clinicalContext);\n            } catch (error) {\n                console.error('Local model error:', error);\n            }\n        }\n        \n        // Fallback to rule-based analysis\n        return this.fallbackAnalysis(processedText, analysisType, clinicalContext);\n    }\n    \n    /**\n     * Analyze image with optional clinical context\n     */\n    async analyzeImage(imageData, analysisType, clinicalContext = null) {\n        // For image analysis, we'll use a combination of local processing and rule-based analysis\n        // In a production app, you would use a proper vision model\n        \n        const analysis = {\n            type: 'image',\n            analysisType: analysisType,\n            timestamp: Date.now(),\n            clinicalContext: clinicalContext,\n            results: {}\n        };\n        \n        // Context-aware image analysis\n        const specialty = clinicalContext?.specialty?.id || 'general';\n        const reportType = clinicalContext?.reportType?.name || 'Medical Image';\n        \n        if (analysisType === 'diagnosis') {\n            analysis.results = this.getImageDiagnosisResults(specialty, reportType);\n        } else if (analysisType === 'findings') {\n            analysis.results = this.getImageFindingsResults(specialty, reportType);\n        } else {\n            analysis.results = {\n                summary: `${reportType} analysis completed for ${specialty} specialty.`,\n                findings: ['Image analyzed based on clinical context'],\n                confidence: 0.75\n            };\n        }\n        \n        return analysis.results;\n    }\n    \n    /**\n     * Get specialty-specific image diagnosis results\n     */\n    getImageDiagnosisResults(specialty, reportType) {\n        const specialtyAnalysis = {\n            ent: {\n                summary: `${reportType} analysis completed. ENT-specific structures evaluated.`,\n                findings: [\n                    'Airway and mucosal surfaces assessed',\n                    'Sinus/ear anatomy structures identified',\n                    'Symmetry and anatomical landmarks noted',\n                    'Soft tissue and bony structures reviewed'\n                ],\n                recommendations: [\n                    'Correlate with audiometry/tympanometry if applicable',\n                    'Consider endoscopic examination for detailed assessment',\n                    'Review for signs of inflammation or obstruction'\n                ]\n            },\n            dental: {\n                summary: `${reportType} analysis completed. Dental structures evaluated.`,\n                findings: [\n                    'Tooth anatomy and alignment assessed',\n                    'Periodontal structures reviewed',\n                    'Bone density and levels evaluated',\n                    'Root canal and periapical regions examined'\n                ],\n                recommendations: [\n                    'Note any carious lesions or restorations',\n                    'Evaluate periodontal pocket depths clinically',\n                    'Consider CBCT for complex cases'\n                ]\n            },\n            dermatology: {\n                summary: `${reportType} analysis completed. Skin lesion evaluated.`,\n                findings: [\n                    'Lesion borders and symmetry assessed',\n                    'Color variation and pigmentation noted',\n                    'Texture and surface characteristics evaluated',\n                    'Size and dermoscopic patterns documented'\n                ],\n                recommendations: [\n                    'Apply ABCDE criteria for melanoma screening',\n                    'Consider biopsy if atypical features present',\n                    'Document for future comparison'\n                ]\n            },\n            vitals: {\n                summary: `${reportType} trends analyzed.`,\n                findings: [\n                    'Vital sign patterns reviewed',\n                    'Trend analysis completed',\n                    'Abnormal values flagged'\n                ],\n                recommendations: [\n                    'Correlate with clinical presentation',\n                    'Monitor for concerning trends'\n                ]\n            },\n            cardiology: {\n                summary: `${reportType} analysis completed. Cardiac structures evaluated.`,\n                findings: [\n                    'Cardiac chambers and walls assessed',\n                    'Valve structures reviewed',\n                    'Wall motion analysis completed',\n                    'Great vessels evaluated'\n                ],\n                recommendations: [\n                    'Correlate with ECG findings',\n                    'Assess ejection fraction',\n                    'Note any structural abnormalities'\n                ]\n            }\n        };\n        \n        const result = specialtyAnalysis[specialty] || {\n            summary: `${reportType} analysis completed.`,\n            findings: ['Image quality adequate for review', 'Anatomical structures identified'],\n            recommendations: ['Correlate with clinical findings', 'Review with specialist if needed']\n        };\n        \n        result.confidence = 0.78;\n        return result;\n    }\n    \n    /**\n     * Get specialty-specific image findings results\n     */\n    getImageFindingsResults(specialty, reportType) {\n        return {\n            summary: `Key findings from ${reportType} for ${specialty} review:`,\n            findings: [\n                'Primary area of interest identified',\n                'Tissue/structure characteristics noted',\n                'Comparison baseline established',\n                'Measurements documented where applicable'\n            ],\n            confidence: 0.82\n        };\n    }\n    \n    async analyzeVideo(videoData, analysisType, clinicalContext = null) {\n        // Video analysis - extract frames and analyze\n        const analysis = {\n            type: 'video',\n            analysisType: analysisType,\n            timestamp: Date.now(),\n            results: {}\n        };\n        \n        analysis.results = {\n            summary: 'Video examination analysis completed. Dynamic assessment of the recorded procedure/examination.',\n            findings: [\n                'Video quality suitable for clinical assessment',\n                'Motion patterns analyzed throughout recording',\n                'Key frames identified for detailed review',\n                'Temporal progression of examination documented',\n                'Areas of clinical interest flagged for attention'\n            ],\n            recommendations: [\n                'Review highlighted frames for detailed findings',\n                'Note any procedural observations',\n                'Compare with previous examinations if available',\n                'Document findings in structured format'\n            ],\n            duration: 'Analysis based on video content',\n            confidence: 0.75\n        };\n        \n        return analysis.results;\n    }\n    \n    generateMedicalAnalysis(text, classification, analysisType, clinicalContext = null) {\n        const sentiment = classification[0];\n        const words = text.toLowerCase().split(/\\s+/);\n        \n        // Get specialty-specific vocabulary if context provided\n        const specialty = clinicalContext?.specialty?.id;\n        const ageGroup = clinicalContext?.ageGroup;\n        const reportType = clinicalContext?.reportType;\n        \n        // Build vocabulary list based on context\n        let vocabularyToUse = [...MEDICAL_VOCABULARY.general];\n        if (specialty && MEDICAL_VOCABULARY[specialty]) {\n            vocabularyToUse = [...MEDICAL_VOCABULARY[specialty], ...vocabularyToUse];\n        } else {\n            // Use all vocabularies if no specialty specified\n            vocabularyToUse = [\n                ...MEDICAL_VOCABULARY.ent,\n                ...MEDICAL_VOCABULARY.dental,\n                ...MEDICAL_VOCABULARY.dermatology,\n                ...MEDICAL_VOCABULARY.vitals,\n                ...MEDICAL_VOCABULARY.cardiology,\n                ...MEDICAL_VOCABULARY.general\n            ];\n        }\n        \n        // Use enhanced medical vocabulary from ConfigManager\n        const foundSymptoms = this.findMedicalTerms(words, ['pain', 'ache', 'swelling', 'inflammation', 'discharge', 'fever', 'loss', 'difficulty', 'bleeding', 'numbness', 'tingling']);\n        const foundConditions = this.findMedicalTerms(words, vocabularyToUse);\n        const foundAnatomy = this.findMedicalTerms(words, this.getAnatomyTerms(specialty));\n        const foundSeverity = this.findMedicalTerms(words, ['mild', 'moderate', 'severe', 'acute', 'chronic', 'persistent', 'recurrent', 'bilateral', 'unilateral']);\n        \n        const results = {\n            summary: '',\n            findings: [],\n            recommendations: [],\n            confidence: 0,\n            clinicalContext: clinicalContext ? {\n                specialty: clinicalContext.specialty?.name,\n                ageGroup: clinicalContext.ageGroup?.name,\n                reportType: clinicalContext.reportType?.name\n            } : null\n        };\n        \n        // Get specialty-specific analysis\n        const specialtyName = clinicalContext?.specialty?.name || 'General';\n        const ageGroupName = ageGroup?.name || '';\n        \n        switch (analysisType) {\n            case 'diagnosis':\n                results.summary = this.generateDiagnosisSummary(foundConditions, foundAnatomy, specialty, ageGroupName);\n                results.findings = this.generateDiagnosisFindings(foundSymptoms, foundConditions, foundSeverity, specialty);\n                results.recommendations = this.generateDiagnosisRecommendations(foundConditions, foundSymptoms, specialty, ageGroup);\n                results.confidence = Math.min(0.65 + (foundConditions.length * 0.05) + (foundSymptoms.length * 0.03), 0.92);\n                break;\n                \n            case 'summary':\n                results.summary = `${specialtyName} assessment for ${ageGroupName || 'patient'}. ${foundAnatomy.length > 0 ? `Involves: ${foundAnatomy.join(', ')}.` : ''} ${text.length > 200 ? text.substring(0, 200) + '...' : text}`;\n                results.confidence = 0.88;\n                break;\n                \n            case 'findings':\n                results.summary = `Key ${specialtyName.toLowerCase()} findings extracted:`;\n                results.findings = [\n                    `Specialty Focus: ${specialtyName}`,\n                    `Anatomical areas: ${foundAnatomy.length > 0 ? foundAnatomy.join(', ') : 'To be identified'}`,\n                    `Symptom profile: ${foundSymptoms.length > 0 ? foundSymptoms.join(', ') : 'To be determined'}`,\n                    `Clinical indicators: ${foundConditions.length > 0 ? foundConditions.join(', ') : 'Pending evaluation'}`,\n                    `Severity: ${foundSeverity.length > 0 ? foundSeverity.join(', ') : 'To be assessed'}`,\n                    ...(ageGroupName ? [`Age considerations: ${ageGroupName}`] : [])\n                ];\n                results.confidence = 0.80;\n                break;\n                \n            case 'recommendations':\n                results.summary = `${specialtyName} recommendations based on clinical documentation:`;\n                results.recommendations = this.generateDiagnosisRecommendations(foundConditions, foundSymptoms, specialty, ageGroup);\n                results.confidence = 0.72;\n                break;\n        }\n        \n        return results;\n    }\n    \n    /**\n     * Get anatomy terms based on specialty\n     */\n    getAnatomyTerms(specialty) {\n        const anatomyBySpecialty = {\n            ent: ['ear', 'nose', 'throat', 'sinus', 'larynx', 'pharynx', 'tympanic', 'cochlea', 'vestibular', 'eustachian', 'turbinate', 'septum', 'adenoid', 'tonsil'],\n            dental: ['teeth', 'tooth', 'gum', 'gingiva', 'tongue', 'mandible', 'maxilla', 'jaw', 'palate', 'pulp', 'root', 'crown', 'enamel', 'dentin'],\n            dermatology: ['skin', 'dermis', 'epidermis', 'subcutaneous', 'nail', 'hair', 'scalp', 'mucosa'],\n            vitals: ['heart', 'lung', 'chest', 'abdomen'],\n            cardiology: ['heart', 'cardiac', 'coronary', 'valve', 'ventricle', 'atrium', 'aorta', 'pulmonary']\n        };\n        \n        if (specialty && anatomyBySpecialty[specialty]) {\n            return anatomyBySpecialty[specialty];\n        }\n        \n        // Return all anatomy terms if no specialty\n        return Object.values(anatomyBySpecialty).flat();\n    }\n    \n    /**\n     * Generate specialty-specific diagnosis summary\n     */\n    generateDiagnosisSummary(conditions, anatomy, specialty, ageGroup) {\n        const specialtyIntros = {\n            ent: 'ENT clinical assessment:',\n            dental: 'Dental/oral health assessment:',\n            dermatology: 'Dermatological assessment:',\n            vitals: 'Vital signs assessment:',\n            cardiology: 'Cardiovascular assessment:'\n        };\n        \n        let summary = specialtyIntros[specialty] || 'Clinical assessment:';\n        \n        if (conditions.length > 0) {\n            summary += ` Potential conditions: ${conditions.slice(0, 5).join(', ')}.`;\n        }\n        \n        if (anatomy.length > 0) {\n            summary += ` Affected areas: ${anatomy.join(', ')}.`;\n        }\n        \n        if (ageGroup) {\n            summary += ` (${ageGroup} patient)`;\n        }\n        \n        if (conditions.length === 0 && anatomy.length === 0) {\n            summary += ' Further clinical evaluation recommended.';\n        }\n        \n        return summary;\n    }\n    \n    /**\n     * Generate specialty-specific findings\n     */\n    generateDiagnosisFindings(symptoms, conditions, severity, specialty) {\n        const findings = [];\n        \n        if (symptoms.length > 0) {\n            findings.push(`Reported symptoms: ${symptoms.join(', ')}`);\n        } else {\n            findings.push('No specific symptoms documented');\n        }\n        \n        if (severity.length > 0) {\n            findings.push(`Severity indicators: ${severity.join(', ')}`);\n        }\n        \n        if (conditions.length > 0) {\n            findings.push(`Possible conditions: ${conditions.slice(0, 5).join(', ')}`);\n        }\n        \n        // Add specialty-specific findings hints\n        const specialtyHints = {\n            ent: 'Consider audiological and vestibular evaluation',\n            dental: 'Periodontal and radiographic assessment recommended',\n            dermatology: 'Document lesion characteristics (ABCDE)',\n            vitals: 'Establish baseline and trend analysis',\n            cardiology: 'Correlate with ECG and imaging'\n        };\n        \n        if (specialty && specialtyHints[specialty]) {\n            findings.push(specialtyHints[specialty]);\n        }\n        \n        findings.push('Clinical correlation recommended');\n        \n        return findings;\n    }\n    \n    /**\n     * Generate age and specialty-appropriate recommendations\n     */\n    generateDiagnosisRecommendations(conditions, symptoms, specialty, ageGroup) {\n        const recommendations = [];\n        \n        // Basic recommendations\n        recommendations.push('Complete clinical examination');\n        \n        // Symptom-based recommendations\n        if (symptoms.some(s => s.includes('pain'))) {\n            recommendations.push('Assess pain characteristics using appropriate scale');\n        }\n        \n        // Condition-based recommendations\n        if (conditions.some(c => c.includes('infection') || c.includes('itis'))) {\n            recommendations.push('Consider culture/sensitivity if infection suspected');\n        }\n        \n        // Specialty-specific recommendations\n        const specialtyRecs = {\n            ent: ['Consider audiometry/tympanometry if hearing concerns', 'Endoscopic examination if indicated'],\n            dental: ['Obtain appropriate radiographs', 'Periodontal probing assessment'],\n            dermatology: ['Dermoscopic examination if indicated', 'Consider biopsy for suspicious lesions'],\n            vitals: ['Monitor trends over time', 'Review medication effects on vitals'],\n            cardiology: ['12-lead ECG if not recent', 'Consider echocardiogram if structural abnormality suspected']\n        };\n        \n        if (specialty && specialtyRecs[specialty]) {\n            recommendations.push(...specialtyRecs[specialty].slice(0, 2));\n        }\n        \n        // Age-specific recommendations\n        if (ageGroup) {\n            const ageId = ageGroup.id;\n            if (ageId === 'neonate' || ageId === 'infant') {\n                recommendations.push('Age-appropriate developmental assessment');\n            } else if (ageId === 'elderly') {\n                recommendations.push('Consider geriatric assessment and fall risk');\n                recommendations.push('Review polypharmacy');\n            } else if (ageId === 'child' || ageId === 'adolescent') {\n                recommendations.push('Age-appropriate communication with patient/guardian');\n            }\n        }\n        \n        recommendations.push('Schedule appropriate follow-up');\n        \n        return [...new Set(recommendations)]; // Remove duplicates\n    }\n    \n    fallbackAnalysis(text, analysisType, clinicalContext = null) {\n        // Rule-based fallback when no ML model is available\n        return this.generateMedicalAnalysis(text, [{ label: 'NEUTRAL', score: 0.5 }], analysisType, clinicalContext);\n    }\n    \n    /**\n     * Find medical terms in text\n     */\n    findMedicalTerms(words, termList) {\n        const found = new Set();\n        words.forEach(word => {\n            termList.forEach(term => {\n                if (word.includes(term) || term.includes(word)) {\n                    found.add(term);\n                }\n            });\n        });\n        return Array.from(found);\n    }\n    \n    async getEmbedding(text) {\n        if (this.useLocalModel && this.pipelines.has('embedding')) {\n            try {\n                const extractor = this.pipelines.get('embedding');\n                const embedding = await extractor(text, { pooling: 'mean', normalize: true });\n                return Array.from(embedding.data);\n            } catch (error) {\n                console.error('Embedding extraction error:', error);\n            }\n        }\n        return null;\n    }\n    \n    /**\n     * Check if models are cached and available offline\n     */\n    async getOfflineStatus() {\n        const status = {\n            available: [],\n            missing: [],\n            totalCacheSize: 0\n        };\n        \n        for (const [key, config] of Object.entries(MODELS)) {\n            const cached = await cacheManager.isModelCached(config.id);\n            if (cached) {\n                status.available.push({ key, ...config });\n            } else {\n                status.missing.push({ key, ...config });\n            }\n        }\n        \n        status.totalCacheSize = await cacheManager.getCacheSize();\n        status.formattedSize = formatBytes(status.totalCacheSize);\n        status.isFullyOffline = status.missing.length === 0;\n        \n        return status;\n    }\n    \n    /**\n     * Pre-download models for offline use\n     */\n    async downloadForOffline(progressCallback) {\n        if (!offlineManager.isOnline) {\n            throw new Error('Cannot download models while offline');\n        }\n        \n        return this.initialize(progressCallback, { \n            loadRequired: true, \n            loadOptional: true,\n            forceDownload: false \n        });\n    }\n    \n    /**\n     * Clear cached models\n     */\n    async clearCache() {\n        await cacheManager.clearModelCache();\n        this.pipelines.clear();\n        this.isInitialized = false;\n        console.log(' Model cache cleared');\n    }\n    \n    isReady() {\n        return this.isInitialized;\n    }\n    \n    getStatus() {\n        return {\n            initialized: this.isInitialized,\n            localModelAvailable: this.useLocalModel,\n            modelsLoaded: Object.fromEntries(\n                [...this.pipelines.entries()].map(([key]) => [key, true])\n            ),\n            loadingState: this.loadingState,\n            isOnline: offlineManager.isOnline\n        };\n    }\n}\n","/**\n * Selection Manager\n * Handles text, image, video, and screen region selection\n * Provides unified interface for content selection across the application\n */\nexport class SelectionManager {\n    constructor() {\n        this.currentSelection = null;\n        this.listeners = new Map();\n        this.highlightedElements = [];\n    }\n    \n    initialize() {\n        this.setupTextSelection();\n        this.setupContentSelection();\n        this.setupKeyboardShortcuts();\n    }\n    \n    setupTextSelection() {\n        // Monitor text selection in the content area\n        document.addEventListener('mouseup', (e) => {\n            const selection = window.getSelection();\n            const selectedText = selection.toString().trim();\n            \n            if (selectedText.length > 0) {\n                // Check if selection is within content area\n                const contentDisplay = document.getElementById('content-display');\n                if (contentDisplay && contentDisplay.contains(selection.anchorNode)) {\n                    const range = selection.getRangeAt(0);\n                    const rect = range.getBoundingClientRect();\n                    \n                    this.setSelection({\n                        type: 'text',\n                        content: selectedText,\n                        position: {\n                            x: rect.left + rect.width / 2,\n                            y: rect.top\n                        },\n                        timestamp: Date.now()\n                    });\n                }\n            }\n        });\n        \n        // Hide toolbar when clicking elsewhere\n        document.addEventListener('mousedown', (e) => {\n            const toolbar = document.getElementById('selection-toolbar');\n            if (toolbar && !toolbar.contains(e.target)) {\n                // Small delay to allow click handlers to process\n                setTimeout(() => {\n                    const selection = window.getSelection();\n                    if (!selection.toString().trim()) {\n                        toolbar.classList.remove('visible');\n                    }\n                }, 100);\n            }\n        });\n    }\n    \n    setupContentSelection() {\n        // Handle clicks on selectable content (images, videos)\n        document.addEventListener('click', (e) => {\n            const selectableContent = e.target.closest('.selectable-content');\n            \n            if (selectableContent) {\n                // Deselect previous\n                document.querySelectorAll('.selectable-content.selected').forEach(el => {\n                    if (el !== selectableContent) {\n                        el.classList.remove('selected');\n                    }\n                });\n                \n                // Toggle selection\n                selectableContent.classList.toggle('selected');\n                \n                if (selectableContent.classList.contains('selected')) {\n                    const type = selectableContent.dataset.type;\n                    let content = '';\n                    \n                    switch (type) {\n                        case 'image':\n                            const img = selectableContent.querySelector('img');\n                            content = img ? img.src : '';\n                            break;\n                        case 'video':\n                            const video = selectableContent.querySelector('video');\n                            content = video ? video.src : '';\n                            // Also get current frame if video is paused\n                            if (video && video.paused) {\n                                content = this.captureVideoFrame(video);\n                            }\n                            break;\n                    }\n                    \n                    const rect = selectableContent.getBoundingClientRect();\n                    \n                    this.setSelection({\n                        type: type,\n                        content: content,\n                        element: selectableContent,\n                        position: {\n                            x: rect.left + rect.width / 2,\n                            y: rect.top\n                        },\n                        timestamp: Date.now()\n                    });\n                } else {\n                    this.clearSelection();\n                }\n            }\n        });\n    }\n    \n    setupKeyboardShortcuts() {\n        document.addEventListener('keydown', (e) => {\n            // Ctrl/Cmd + Shift + A: Analyze selection\n            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'A') {\n                e.preventDefault();\n                if (this.currentSelection) {\n                    this.emit('analyze-request', this.currentSelection);\n                }\n            }\n            \n            // Escape: Clear selection\n            if (e.key === 'Escape') {\n                this.clearSelection();\n                document.getElementById('selection-toolbar')?.classList.remove('visible');\n            }\n        });\n    }\n    \n    captureVideoFrame(video) {\n        try {\n            const canvas = document.createElement('canvas');\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n            const ctx = canvas.getContext('2d');\n            ctx.drawImage(video, 0, 0);\n            return canvas.toDataURL('image/png');\n        } catch (error) {\n            console.error('Could not capture video frame:', error);\n            return video.src;\n        }\n    }\n    \n    setSelection(selection) {\n        this.currentSelection = selection;\n        this.emit('selection', selection);\n    }\n    \n    getCurrentSelection() {\n        return this.currentSelection;\n    }\n    \n    clearSelection() {\n        this.currentSelection = null;\n        document.querySelectorAll('.selectable-content.selected').forEach(el => {\n            el.classList.remove('selected');\n        });\n        this.emit('selection-cleared');\n    }\n    \n    highlightSelection() {\n        if (!this.currentSelection) return;\n        \n        if (this.currentSelection.type === 'text') {\n            // Create highlight span\n            const selection = window.getSelection();\n            if (selection.rangeCount > 0) {\n                const range = selection.getRangeAt(0);\n                const highlight = document.createElement('mark');\n                highlight.className = 'ai-highlight';\n                highlight.style.backgroundColor = 'rgba(37, 99, 235, 0.2)';\n                highlight.style.padding = '2px 0';\n                \n                try {\n                    range.surroundContents(highlight);\n                    this.highlightedElements.push(highlight);\n                } catch (error) {\n                    // Handle complex selections that cross DOM boundaries\n                    console.warn('Could not highlight selection:', error);\n                }\n            }\n        } else if (this.currentSelection.element) {\n            this.currentSelection.element.style.outline = '3px solid var(--primary-color)';\n            this.highlightedElements.push(this.currentSelection.element);\n        }\n    }\n    \n    clearHighlights() {\n        this.highlightedElements.forEach(el => {\n            if (el.tagName === 'MARK') {\n                el.replaceWith(...el.childNodes);\n            } else {\n                el.style.outline = '';\n            }\n        });\n        this.highlightedElements = [];\n    }\n    \n    registerElement(element) {\n        // Make an element selectable\n        element.classList.add('selectable-content');\n        element.dataset.type = element.dataset.type || 'content';\n    }\n    \n    // Event system\n    on(event, callback) {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        this.listeners.get(event).push(callback);\n    }\n    \n    off(event, callback) {\n        if (this.listeners.has(event)) {\n            const callbacks = this.listeners.get(event);\n            const index = callbacks.indexOf(callback);\n            if (index > -1) {\n                callbacks.splice(index, 1);\n            }\n        }\n    }\n    \n    emit(event, data) {\n        if (this.listeners.has(event)) {\n            this.listeners.get(event).forEach(callback => callback(data));\n        }\n    }\n    \n    // Get selection as structured data for analysis\n    getSelectionForAnalysis() {\n        if (!this.currentSelection) return null;\n        \n        return {\n            type: this.currentSelection.type,\n            content: this.currentSelection.content,\n            metadata: {\n                timestamp: this.currentSelection.timestamp,\n                source: 'user-selection'\n            }\n        };\n    }\n}\n","/**\n * Analysis Manager\n * Orchestrates AI analysis for different content types\n * Bridges selection and AI model for seamless analysis workflow\n * Now supports clinical context for more accurate analysis\n */\nexport class AnalysisManager {\n    constructor(modelManager) {\n        this.modelManager = modelManager;\n        this.analysisHistory = [];\n        this.maxHistorySize = 50;\n        this.clinicalContext = null; // Current clinical context\n    }\n    \n    /**\n     * Set the clinical context for analysis\n     * @param {Object} context - Clinical context from ClinicalContextManager\n     */\n    setClinicalContext(context) {\n        this.clinicalContext = context;\n    }\n    \n    /**\n     * Get the current clinical context\n     */\n    getClinicalContext() {\n        return this.clinicalContext;\n    }\n    \n    async analyze(selection, analysisType) {\n        if (!selection) {\n            throw new Error('No content selected for analysis');\n        }\n        \n        const startTime = Date.now();\n        let result;\n        \n        switch (selection.type) {\n            case 'text':\n                result = await this.analyzeText(selection.content, analysisType);\n                break;\n            case 'image':\n            case 'screen':\n                result = await this.analyzeImage(selection.content, analysisType);\n                break;\n            case 'video':\n                result = await this.analyzeVideo(selection.content, analysisType);\n                break;\n            case 'combined':\n                result = await this.analyzeCombined(selection.content, analysisType);\n                break;\n            default:\n                throw new Error(`Unsupported content type: ${selection.type}`);\n        }\n        \n        // Record analysis in history with context\n        this.recordAnalysis({\n            type: selection.type,\n            analysisType,\n            result,\n            clinicalContext: this.clinicalContext,\n            duration: Date.now() - startTime,\n            timestamp: Date.now()\n        });\n        \n        return result;\n    }\n    \n    async analyzeText(text, analysisType) {\n        if (!text || text.trim().length === 0) {\n            throw new Error('Empty text cannot be analyzed');\n        }\n        \n        // Use model manager for analysis with clinical context\n        return await this.modelManager.analyzeText(text, analysisType, this.clinicalContext);\n    }\n    \n    async analyzeImage(imageData, analysisType) {\n        if (!imageData) {\n            throw new Error('No image data provided');\n        }\n        \n        // Process image through model with clinical context\n        const result = await this.modelManager.analyzeImage(imageData, analysisType, this.clinicalContext);\n        \n        // Enhance result with image-specific analysis\n        return {\n            ...result,\n            imageAnalysis: {\n                processed: true,\n                type: imageData.startsWith('data:') ? 'base64' : 'url'\n            }\n        };\n    }\n    \n    async analyzeVideo(videoData, analysisType) {\n        if (!videoData) {\n            throw new Error('No video data provided');\n        }\n        \n        // For video, we extract key frames and analyze with clinical context\n        const result = await this.modelManager.analyzeVideo(videoData, analysisType, this.clinicalContext);\n        \n        return {\n            ...result,\n            videoAnalysis: {\n                processed: true,\n                frameAnalysis: 'Key frames extracted and analyzed'\n            }\n        };\n    }\n    \n    /**\n     * Analyze combined content (text + images + screenshot)\n     * This is used when \"Analyze Visible Content\" captures everything\n     */\n    async analyzeCombined(content, analysisType) {\n        const results = {\n            summary: '',\n            findings: [],\n            recommendations: [],\n            confidence: 0,\n            analysisDetails: {},\n            clinicalContext: this.clinicalContext ? {\n                specialty: this.clinicalContext.specialty?.name,\n                ageGroup: this.clinicalContext.ageGroup?.name,\n                reportType: this.clinicalContext.reportType?.name\n            } : null\n        };\n        \n        // Analyze text content with clinical context\n        if (content.text && content.text.length > 0) {\n            const textResult = await this.modelManager.analyzeText(content.text, analysisType, this.clinicalContext);\n            \n            if (textResult.summary) results.summary = textResult.summary;\n            if (textResult.findings) results.findings.push(...textResult.findings);\n            if (textResult.recommendations) results.recommendations.push(...textResult.recommendations);\n            if (textResult.confidence) results.confidence = textResult.confidence;\n            \n            results.analysisDetails.textAnalyzed = true;\n            results.analysisDetails.textLength = content.text.length;\n        }\n        \n        // Analyze images if present\n        if (content.images && content.images.length > 0) {\n            results.findings.push(`${content.images.length} medical image(s) detected and ready for visual review`);\n            \n            // In production, each image would be analyzed by a vision model\n            for (let i = 0; i < Math.min(content.images.length, 3); i++) {\n                const imageResult = await this.modelManager.analyzeImage(content.images[i].src, analysisType);\n                if (imageResult.findings) {\n                    results.findings.push(...imageResult.findings.slice(0, 2));\n                }\n            }\n            \n            results.analysisDetails.imagesAnalyzed = content.images.length;\n        }\n        \n        // Analyze screenshot if present\n        if (content.screenshot) {\n            results.findings.push('Screen capture analyzed for visible clinical data');\n            results.analysisDetails.screenshotAnalyzed = true;\n        }\n        \n        // Deduplicate findings and recommendations\n        results.findings = [...new Set(results.findings)];\n        results.recommendations = [...new Set(results.recommendations)];\n        \n        // Add combined analysis summary\n        if (!results.summary) {\n            results.summary = `Combined analysis of ${results.analysisDetails.textAnalyzed ? 'clinical text' : ''}${results.analysisDetails.imagesAnalyzed ? ` and ${results.analysisDetails.imagesAnalyzed} image(s)` : ''}. Review findings below for clinical decision support.`;\n        }\n        \n        return results;\n    }\n    \n    async analyzeMultiple(selections, analysisType) {\n        // Analyze multiple selections and combine results\n        const results = await Promise.all(\n            selections.map(selection => this.analyze(selection, analysisType))\n        );\n        \n        return this.combineResults(results, analysisType);\n    }\n    \n    combineResults(results, analysisType) {\n        const combined = {\n            summary: '',\n            findings: [],\n            recommendations: [],\n            confidence: 0,\n            combinedFrom: results.length\n        };\n        \n        results.forEach(result => {\n            if (result.summary) {\n                combined.summary += result.summary + ' ';\n            }\n            if (result.findings) {\n                combined.findings.push(...result.findings);\n            }\n            if (result.recommendations) {\n                combined.recommendations.push(...result.recommendations);\n            }\n            if (result.confidence) {\n                combined.confidence += result.confidence;\n            }\n        });\n        \n        // Average confidence\n        combined.confidence = combined.confidence / results.length;\n        \n        // Deduplicate\n        combined.findings = [...new Set(combined.findings)];\n        combined.recommendations = [...new Set(combined.recommendations)];\n        \n        return combined;\n    }\n    \n    recordAnalysis(record) {\n        this.analysisHistory.push(record);\n        \n        // Trim history if too large\n        if (this.analysisHistory.length > this.maxHistorySize) {\n            this.analysisHistory.shift();\n        }\n        \n        // Save to local storage\n        this.saveHistory();\n    }\n    \n    saveHistory() {\n        try {\n            const historyToSave = this.analysisHistory.slice(-20); // Keep last 20\n            localStorage.setItem('analysisHistory', JSON.stringify(historyToSave));\n        } catch (error) {\n            console.warn('Could not save analysis history:', error);\n        }\n    }\n    \n    loadHistory() {\n        try {\n            const saved = localStorage.getItem('analysisHistory');\n            if (saved) {\n                this.analysisHistory = JSON.parse(saved);\n            }\n        } catch (error) {\n            console.warn('Could not load analysis history:', error);\n        }\n    }\n    \n    getHistory() {\n        return this.analysisHistory;\n    }\n    \n    getLastAnalysis() {\n        return this.analysisHistory[this.analysisHistory.length - 1];\n    }\n    \n    clearHistory() {\n        this.analysisHistory = [];\n        localStorage.removeItem('analysisHistory');\n    }\n    \n    // Format result for display\n    formatForDisplay(result) {\n        let html = '<div class=\"analysis-result-formatted\">';\n        \n        if (result.summary) {\n            html += `<div class=\"result-summary\"><strong>Summary:</strong> ${result.summary}</div>`;\n        }\n        \n        if (result.findings && result.findings.length > 0) {\n            html += '<div class=\"result-findings\"><strong>Key Findings:</strong><ul>';\n            result.findings.forEach(finding => {\n                html += `<li><i class=\"fas fa-check-circle\"></i> ${finding}</li>`;\n            });\n            html += '</ul></div>';\n        }\n        \n        if (result.recommendations && result.recommendations.length > 0) {\n            html += '<div class=\"result-recommendations\"><strong>Recommendations:</strong><ul>';\n            result.recommendations.forEach(rec => {\n                html += `<li><i class=\"fas fa-lightbulb\"></i> ${rec}</li>`;\n            });\n            html += '</ul></div>';\n        }\n        \n        if (result.confidence) {\n            const confidencePercent = Math.round(result.confidence * 100);\n            const confidenceClass = confidencePercent > 80 ? 'high' : confidencePercent > 60 ? 'medium' : 'low';\n            html += `<div class=\"result-confidence ${confidenceClass}\">\n                <strong>Confidence:</strong> \n                <span class=\"confidence-bar\">\n                    <span class=\"confidence-fill\" style=\"width: ${confidencePercent}%\"></span>\n                </span>\n                ${confidencePercent}%\n            </div>`;\n        }\n        \n        html += '</div>';\n        return html;\n    }\n    \n    // Export analysis for report\n    exportForReport(result) {\n        return {\n            content: result.summary || '',\n            findings: result.findings || [],\n            recommendations: result.recommendations || [],\n            confidence: result.confidence || 0,\n            exportedAt: new Date().toISOString(),\n            source: 'AI Analysis'\n        };\n    }\n}\n","/**\n * Report Manager\n * Handles report creation, editing, and submission\n * Manages the workflow from AI findings to final report\n */\nexport class ReportManager {\n    constructor() {\n        this.currentReport = this.createNewReport();\n        this.drafts = [];\n        this.loadDrafts();\n    }\n    \n    createNewReport() {\n        return {\n            id: this.generateId(),\n            patientInfo: {\n                name: '',\n                id: '',\n                dateOfBirth: ''\n            },\n            examinationDate: new Date().toISOString().split('T')[0],\n            findings: [],\n            doctorNotes: '',\n            diagnosis: '',\n            recommendations: [],\n            aiAssisted: true,\n            status: 'draft',\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString()\n        };\n    }\n    \n    generateId() {\n        return 'RPT-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();\n    }\n    \n    addFinding(finding) {\n        if (!finding || finding.trim().length === 0) return;\n        \n        const findingObj = {\n            id: Date.now(),\n            content: finding,\n            source: 'ai-analysis',\n            addedAt: new Date().toISOString(),\n            verified: false\n        };\n        \n        this.currentReport.findings.push(findingObj);\n        this.updateUI();\n        this.autoSave();\n        \n        return findingObj;\n    }\n    \n    removeFinding(findingId) {\n        this.currentReport.findings = this.currentReport.findings.filter(f => f.id !== findingId);\n        this.updateUI();\n        this.autoSave();\n    }\n    \n    verifyFinding(findingId) {\n        const finding = this.currentReport.findings.find(f => f.id === findingId);\n        if (finding) {\n            finding.verified = true;\n            finding.verifiedAt = new Date().toISOString();\n        }\n        this.autoSave();\n    }\n    \n    updatePatientInfo() {\n        this.currentReport.patientInfo = {\n            name: document.getElementById('patient-name')?.value || '',\n            id: document.getElementById('patient-id')?.value || ''\n        };\n        this.currentReport.examinationDate = document.getElementById('exam-date')?.value || '';\n    }\n    \n    updateNotes() {\n        this.currentReport.doctorNotes = document.getElementById('doctor-notes')?.value || '';\n        this.currentReport.diagnosis = document.getElementById('final-diagnosis')?.value || '';\n    }\n    \n    updateUI() {\n        const findingsList = document.getElementById('findings-list');\n        if (!findingsList) return;\n        \n        if (this.currentReport.findings.length === 0) {\n            findingsList.innerHTML = '<p class=\"placeholder-text\">No findings added yet. Run AI analysis and add results.</p>';\n            return;\n        }\n        \n        findingsList.innerHTML = this.currentReport.findings.map(finding => `\n            <div class=\"finding-item\" data-id=\"${finding.id}\">\n                <i class=\"fas ${finding.verified ? 'fa-check-circle' : 'fa-circle'}\"></i>\n                <span class=\"finding-content\">${this.truncate(finding.content, 100)}</span>\n                <i class=\"fas fa-times remove-finding\" onclick=\"window.medicalAssistantApp.reportManager.removeFinding(${finding.id})\"></i>\n            </div>\n        `).join('');\n    }\n    \n    truncate(text, maxLength) {\n        if (text.length <= maxLength) return text;\n        return text.substring(0, maxLength) + '...';\n    }\n    \n    saveDraft() {\n        this.updatePatientInfo();\n        this.updateNotes();\n        this.currentReport.updatedAt = new Date().toISOString();\n        this.currentReport.status = 'draft';\n        \n        // Save to local storage\n        const draftIndex = this.drafts.findIndex(d => d.id === this.currentReport.id);\n        if (draftIndex >= 0) {\n            this.drafts[draftIndex] = { ...this.currentReport };\n        } else {\n            this.drafts.push({ ...this.currentReport });\n        }\n        \n        this.saveDraftsToStorage();\n        return this.currentReport;\n    }\n    \n    autoSave() {\n        // Debounced auto-save\n        clearTimeout(this.autoSaveTimeout);\n        this.autoSaveTimeout = setTimeout(() => {\n            this.saveDraft();\n        }, 2000);\n    }\n    \n    loadDrafts() {\n        try {\n            const saved = localStorage.getItem('reportDrafts');\n            if (saved) {\n                this.drafts = JSON.parse(saved);\n            }\n        } catch (error) {\n            console.warn('Could not load drafts:', error);\n            this.drafts = [];\n        }\n    }\n    \n    saveDraftsToStorage() {\n        try {\n            localStorage.setItem('reportDrafts', JSON.stringify(this.drafts));\n        } catch (error) {\n            console.warn('Could not save drafts:', error);\n        }\n    }\n    \n    loadDraft(draftId) {\n        const draft = this.drafts.find(d => d.id === draftId);\n        if (draft) {\n            this.currentReport = { ...draft };\n            this.populateForm();\n            this.updateUI();\n        }\n    }\n    \n    populateForm() {\n        const { patientInfo, examinationDate, doctorNotes, diagnosis } = this.currentReport;\n        \n        if (document.getElementById('patient-name')) {\n            document.getElementById('patient-name').value = patientInfo.name || '';\n        }\n        if (document.getElementById('patient-id')) {\n            document.getElementById('patient-id').value = patientInfo.id || '';\n        }\n        if (document.getElementById('exam-date')) {\n            document.getElementById('exam-date').value = examinationDate || '';\n        }\n        if (document.getElementById('doctor-notes')) {\n            document.getElementById('doctor-notes').value = doctorNotes || '';\n        }\n        if (document.getElementById('final-diagnosis')) {\n            document.getElementById('final-diagnosis').value = diagnosis || '';\n        }\n    }\n    \n    deleteDraft(draftId) {\n        this.drafts = this.drafts.filter(d => d.id !== draftId);\n        this.saveDraftsToStorage();\n    }\n    \n    async submitReport() {\n        this.updatePatientInfo();\n        this.updateNotes();\n        \n        // Validate required fields\n        const errors = this.validateReport();\n        if (errors.length > 0) {\n            throw new Error(`Validation failed: ${errors.join(', ')}`);\n        }\n        \n        this.currentReport.status = 'submitted';\n        this.currentReport.submittedAt = new Date().toISOString();\n        \n        // Prepare report for submission (only structured data, no raw media)\n        const reportData = this.prepareForSubmission();\n        \n        // In production, this would send to your backend server\n        // For now, we simulate the submission\n        console.log(' Submitting report:', reportData);\n        \n        // Simulate network request\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        \n        // Clear draft after successful submission\n        this.deleteDraft(this.currentReport.id);\n        \n        // Reset to new report\n        const submittedReport = { ...this.currentReport };\n        this.currentReport = this.createNewReport();\n        this.populateForm();\n        this.updateUI();\n        \n        return submittedReport;\n    }\n    \n    validateReport() {\n        const errors = [];\n        \n        if (!this.currentReport.patientInfo.name) {\n            errors.push('Patient name is required');\n        }\n        if (!this.currentReport.patientInfo.id) {\n            errors.push('Patient ID is required');\n        }\n        if (this.currentReport.findings.length === 0) {\n            errors.push('At least one finding is required');\n        }\n        \n        return errors;\n    }\n    \n    prepareForSubmission() {\n        // Create a clean copy without any media blobs\n        return {\n            reportId: this.currentReport.id,\n            patient: {\n                name: this.currentReport.patientInfo.name,\n                id: this.currentReport.patientInfo.id\n            },\n            examination: {\n                date: this.currentReport.examinationDate,\n                type: 'ENT/Dental'\n            },\n            findings: this.currentReport.findings.map(f => ({\n                content: f.content,\n                source: f.source,\n                verified: f.verified\n            })),\n            doctorNotes: this.currentReport.doctorNotes,\n            diagnosis: this.currentReport.diagnosis,\n            metadata: {\n                aiAssisted: true,\n                submittedAt: new Date().toISOString(),\n                localProcessing: true // Indicates AI ran locally\n            }\n        };\n    }\n    \n    exportAsPDF() {\n        // This would use a library like jsPDF or html2pdf\n        console.log('PDF export would be implemented here');\n        // For now, just log the report\n        console.log(this.prepareForSubmission());\n    }\n    \n    exportAsJSON() {\n        const data = this.prepareForSubmission();\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        \n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `report-${this.currentReport.id}.json`;\n        a.click();\n        \n        URL.revokeObjectURL(url);\n    }\n    \n    getDrafts() {\n        return this.drafts;\n    }\n    \n    getCurrentReport() {\n        return this.currentReport;\n    }\n}\n","/**\n * UI Manager\n * Handles common UI operations like toasts, modals, and notifications\n */\nexport class UIManager {\n    constructor() {\n        this.toastContainer = null;\n        this.initializeToastContainer();\n    }\n    \n    initializeToastContainer() {\n        this.toastContainer = document.getElementById('toast-container');\n        if (!this.toastContainer) {\n            this.toastContainer = document.createElement('div');\n            this.toastContainer.id = 'toast-container';\n            this.toastContainer.className = 'toast-container';\n            document.body.appendChild(this.toastContainer);\n        }\n    }\n    \n    showToast(type, title, message, duration = 4000) {\n        const toast = document.createElement('div');\n        toast.className = `toast ${type}`;\n        \n        const icons = {\n            success: 'fa-check-circle',\n            error: 'fa-exclamation-circle',\n            warning: 'fa-exclamation-triangle',\n            info: 'fa-info-circle'\n        };\n        \n        toast.innerHTML = `\n            <i class=\"fas ${icons[type] || icons.info}\"></i>\n            <div class=\"toast-content\">\n                <div class=\"toast-title\">${title}</div>\n                ${message ? `<div class=\"toast-message\">${message}</div>` : ''}\n            </div>\n            <button class=\"toast-close\" onclick=\"this.parentElement.remove()\">\n                <i class=\"fas fa-times\"></i>\n            </button>\n        `;\n        \n        this.toastContainer.appendChild(toast);\n        \n        // Auto remove after duration\n        setTimeout(() => {\n            toast.style.animation = 'slideOut 0.3s ease forwards';\n            setTimeout(() => toast.remove(), 300);\n        }, duration);\n        \n        return toast;\n    }\n    \n    showModal(options) {\n        const { title, content, buttons = [], onClose } = options;\n        \n        const modal = document.createElement('div');\n        modal.className = 'modal active';\n        modal.innerHTML = `\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h3>${title}</h3>\n                    <button class=\"btn btn-icon modal-close\">\n                        <i class=\"fas fa-times\"></i>\n                    </button>\n                </div>\n                <div class=\"modal-body\">\n                    ${typeof content === 'string' ? content : ''}\n                </div>\n                <div class=\"modal-footer\">\n                    ${buttons.map(btn => `\n                        <button class=\"btn ${btn.primary ? 'btn-primary' : 'btn-secondary'}\" data-action=\"${btn.action}\">\n                            ${btn.icon ? `<i class=\"fas fa-${btn.icon}\"></i>` : ''}\n                            ${btn.label}\n                        </button>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n        \n        // Handle content if it's an element\n        if (typeof content !== 'string') {\n            modal.querySelector('.modal-body').appendChild(content);\n        }\n        \n        // Event handlers\n        modal.querySelector('.modal-close').addEventListener('click', () => {\n            this.closeModal(modal);\n            if (onClose) onClose();\n        });\n        \n        // Button handlers\n        buttons.forEach(btn => {\n            const button = modal.querySelector(`[data-action=\"${btn.action}\"]`);\n            if (button && btn.onClick) {\n                button.addEventListener('click', () => {\n                    btn.onClick();\n                    if (btn.closeOnClick !== false) {\n                        this.closeModal(modal);\n                    }\n                });\n            }\n        });\n        \n        // Close on background click\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) {\n                this.closeModal(modal);\n                if (onClose) onClose();\n            }\n        });\n        \n        document.body.appendChild(modal);\n        return modal;\n    }\n    \n    closeModal(modal) {\n        modal.classList.remove('active');\n        setTimeout(() => modal.remove(), 200);\n    }\n    \n    showConfirm(title, message) {\n        return new Promise((resolve) => {\n            this.showModal({\n                title,\n                content: `<p>${message}</p>`,\n                buttons: [\n                    {\n                        label: 'Cancel',\n                        action: 'cancel',\n                        onClick: () => resolve(false)\n                    },\n                    {\n                        label: 'Confirm',\n                        action: 'confirm',\n                        primary: true,\n                        onClick: () => resolve(true)\n                    }\n                ],\n                onClose: () => resolve(false)\n            });\n        });\n    }\n    \n    showLoading(message = 'Loading...') {\n        const loader = document.createElement('div');\n        loader.className = 'loading-overlay';\n        loader.id = 'loading-overlay';\n        loader.innerHTML = `\n            <div class=\"loading-spinner\">\n                <i class=\"fas fa-spinner fa-spin\"></i>\n                <span>${message}</span>\n            </div>\n        `;\n        document.body.appendChild(loader);\n        return loader;\n    }\n    \n    hideLoading() {\n        const loader = document.getElementById('loading-overlay');\n        if (loader) {\n            loader.remove();\n        }\n    }\n    \n    updateProgress(element, progress, text) {\n        if (element) {\n            const progressBar = element.querySelector('.progress-fill');\n            const progressText = element.querySelector('.progress-text');\n            \n            if (progressBar) {\n                progressBar.style.width = `${progress}%`;\n            }\n            if (progressText && text) {\n                progressText.textContent = text;\n            }\n        }\n    }\n    \n    // Utility to format dates\n    formatDate(date) {\n        return new Date(date).toLocaleDateString('en-US', {\n            year: 'numeric',\n            month: 'short',\n            day: 'numeric'\n        });\n    }\n    \n    formatTime(date) {\n        return new Date(date).toLocaleTimeString('en-US', {\n            hour: '2-digit',\n            minute: '2-digit'\n        });\n    }\n    \n    formatDateTime(date) {\n        return `${this.formatDate(date)} ${this.formatTime(date)}`;\n    }\n    \n    // Sanitize HTML to prevent XSS\n    sanitizeHTML(str) {\n        const temp = document.createElement('div');\n        temp.textContent = str;\n        return temp.innerHTML;\n    }\n    \n    // Copy to clipboard\n    async copyToClipboard(text) {\n        try {\n            await navigator.clipboard.writeText(text);\n            this.showToast('success', 'Copied', 'Text copied to clipboard');\n            return true;\n        } catch (error) {\n            console.error('Copy failed:', error);\n            this.showToast('error', 'Copy Failed', 'Could not copy to clipboard');\n            return false;\n        }\n    }\n}\n","// Main Application Entry Point\nimport { App } from './app/App.js';\nimport { ModelManager } from './ai/ModelManager.js';\nimport { SelectionManager } from './features/SelectionManager.js';\nimport { AnalysisManager } from './features/AnalysisManager.js';\nimport { ReportManager } from './features/ReportManager.js';\nimport { UIManager } from './ui/UIManager.js';\n\n// Initialize application when DOM is ready\ndocument.addEventListener('DOMContentLoaded', async () => {\n    console.log(' AI Medical Assistant - Initializing...');\n    \n    // Initialize core components\n    const modelManager = new ModelManager();\n    const uiManager = new UIManager();\n    const selectionManager = new SelectionManager();\n    const analysisManager = new AnalysisManager(modelManager);\n    const reportManager = new ReportManager();\n    \n    // Initialize main app\n    const app = new App({\n        modelManager,\n        uiManager,\n        selectionManager,\n        analysisManager,\n        reportManager\n    });\n    \n    await app.initialize();\n    \n    // Make app globally accessible for debugging\n    window.medicalAssistantApp = app;\n    \n    console.log(' AI Medical Assistant - Ready');\n});\n"],"file":"assets/index-D3jRhgFq.js"}